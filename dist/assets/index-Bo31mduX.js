import{r as L,j as u}from"./index-DMXgV45R.js";function j(e){return e._type==="span"&&"text"in e&&typeof e.text=="string"&&(typeof e.marks>"u"||Array.isArray(e.marks)&&e.marks.every(t=>typeof t=="string"))}function M(e){return typeof e._type=="string"&&e._type[0]!=="@"&&(!("markDefs"in e)||!e.markDefs||Array.isArray(e.markDefs)&&e.markDefs.every(t=>typeof t._key=="string"))&&"children"in e&&Array.isArray(e.children)&&e.children.every(t=>typeof t=="object"&&"_type"in t)}function $(e){return M(e)&&"listItem"in e&&typeof e.listItem=="string"&&(typeof e.level>"u"||typeof e.level=="number")}function P(e){return e._type==="@list"}function O(e){return e._type==="@span"}function U(e){return e._type==="@text"}const v=["strong","em","code","underline","strike-through"];function W(e,t,n){if(!j(e)||!e.marks)return[];if(!e.marks.length)return[];const r=e.marks.slice(),a={};return r.forEach(l=>{a[l]=1;for(let o=t+1;o<n.length;o++){const y=n[o];if(y&&j(y)&&Array.isArray(y.marks)&&y.marks.indexOf(l)!==-1)a[l]++;else break}}),r.sort((l,o)=>K(a,l,o))}function K(e,t,n){const r=e[t],a=e[n];if(r!==a)return a-r;const l=v.indexOf(t),o=v.indexOf(n);return l!==o?l-o:t.localeCompare(n)}function C(e){var t;const{children:n}=e,r=e.markDefs??[];if(!n||!n.length)return[];const a=n.map(W),l={_type:"@span",children:[],markType:"<unknown>"};let o=[l];for(let y=0;y<n.length;y++){const m=n[y];if(!m)continue;const I=a[y]||[];let x=1;if(o.length>1)for(x;x<o.length;x++){const i=((t=o[x])==null?void 0:t.markKey)||"",c=I.indexOf(i);if(c===-1)break;I.splice(c,1)}o=o.slice(0,x);let s=o[o.length-1];if(s){for(const i of I){const c=r==null?void 0:r.find(k=>k._key===i),p=c?c._type:i,f={_type:"@span",_key:m._key,children:[],markDef:c,markType:p,markKey:i};s.children.push(f),o.push(f),s=f}if(j(m)){const i=m.text.split(`
`);for(let c=i.length;c-- >1;)i.splice(c,0,`
`);s.children=s.children.concat(i.map(c=>({_type:"@text",text:c})))}else s.children=s.children.concat(m)}}return l.children}function F(e,t){const n=[];let r;for(let a=0;a<e.length;a++){const l=e[a];if(l){if(!$(l)){n.push(l),r=void 0;continue}if(!r){r=g(l,a,t),n.push(r);continue}if(H(l,r)){r.children.push(l);continue}if((l.level||1)>r.level){const o=g(l,a,t);if(t==="html"){const y=r.children[r.children.length-1],m={...y,children:[...y.children,o]};r.children[r.children.length-1]=m}else r.children.push(o);r=o;continue}if((l.level||1)<r.level){const o=n[n.length-1],y=o&&b(o,l);if(y){r=y,r.children.push(l);continue}r=g(l,a,t),n.push(r);continue}if(l.listItem!==r.listItem){const o=n[n.length-1],y=o&&b(o,{level:l.level||1});if(y&&y.listItem===l.listItem){r=y,r.children.push(l);continue}else{r=g(l,a,t),n.push(r);continue}}console.warn("Unknown state encountered for block",l),n.push(l)}}return n}function H(e,t){return(e.level||1)===t.level&&e.listItem===t.listItem}function g(e,t,n){return{_type:"@list",_key:`${e._key||`${t}`}-parent`,mode:n,level:e.level||1,listItem:e.listItem,children:[e]}}function b(e,t){const n=t.level||1,r=t.listItem||"normal",a=typeof t.listItem=="string";if(P(e)&&(e.level||1)===n&&a&&(e.listItem||"normal")===r)return e;if(!("children"in e))return;const l=e.children[e.children.length-1];return l&&!j(l)?b(l,t):void 0}function A(e){let t="";return e.children.forEach(n=>{U(n)?t+=n.text:O(n)&&(t+=A(n))}),t}const q="html",R={number:({children:e})=>u.jsx("ol",{children:e}),bullet:({children:e})=>u.jsx("ul",{children:e})},z=({children:e})=>u.jsx("li",{children:e}),V=({children:e,value:t})=>u.jsx("a",{href:t==null?void 0:t.href,children:e}),G={textDecoration:"underline"},J={em:({children:e})=>u.jsx("em",{children:e}),strong:({children:e})=>u.jsx("strong",{children:e}),code:({children:e})=>u.jsx("code",{children:e}),underline:({children:e})=>u.jsx("span",{style:G,children:e}),"strike-through":({children:e})=>u.jsx("del",{children:e}),link:V},w=(e,t)=>`[@portabletext/react] Unknown ${e}, specify a component for it in the \`components.${t}\` prop`,N=e=>w(`block type "${e}"`,"types"),Q=e=>w(`mark type "${e}"`,"marks"),X=e=>w(`block style "${e}"`,"block"),Y=e=>w(`list style "${e}"`,"list"),Z=e=>w(`list item style "${e}"`,"listItem");function ee(e){console.warn(e)}const D={display:"none"},te=({value:e,isInline:t})=>{const n=N(e._type);return t?u.jsx("span",{style:D,children:n}):u.jsx("div",{style:D,children:n})},ne=({markType:e,children:t})=>u.jsx("span",{className:`unknown__pt__mark__${e}`,children:t}),re=({children:e})=>u.jsx("p",{children:e}),le=({children:e})=>u.jsx("ul",{children:e}),se=({children:e})=>u.jsx("li",{children:e}),ie=()=>u.jsx("br",{}),oe={normal:({children:e})=>u.jsx("p",{children:e}),blockquote:({children:e})=>u.jsx("blockquote",{children:e}),h1:({children:e})=>u.jsx("h1",{children:e}),h2:({children:e})=>u.jsx("h2",{children:e}),h3:({children:e})=>u.jsx("h3",{children:e}),h4:({children:e})=>u.jsx("h4",{children:e}),h5:({children:e})=>u.jsx("h5",{children:e}),h6:({children:e})=>u.jsx("h6",{children:e})},S={types:{},block:oe,marks:J,list:R,listItem:z,hardBreak:ie,unknownType:te,unknownMark:ne,unknownList:le,unknownListItem:se,unknownBlockStyle:re};function ce(e,t){const{block:n,list:r,listItem:a,marks:l,types:o,...y}=t;return{...e,block:_(e,t,"block"),list:_(e,t,"list"),listItem:_(e,t,"listItem"),marks:_(e,t,"marks"),types:_(e,t,"types"),...y}}function _(e,t,n){const r=t[n],a=e[n];return typeof r=="function"||r&&typeof a=="function"?r:r?{...a,...r}:a}function ye({value:e,components:t,listNestingMode:n,onMissingComponent:r=ee}){const a=r||ae,l=Array.isArray(e)?e:[e],o=F(l,n||q),y=L.useMemo(()=>t?ce(S,t):S,[t]),m=L.useMemo(()=>ue(y,a),[y,a]),I=o.map((x,s)=>m({node:x,index:s,isInline:!1,renderNode:m}));return u.jsx(u.Fragment,{children:I})}const ue=(e,t)=>{function n(s){const{node:i,index:c,isInline:p}=s,f=i._key||`node-${c}`;return P(i)?l(i,c,f):$(i)?a(i,c,f):O(i)?o(i,c,f):r(i)?x(i,c,f,p):M(i)?y(i,c,f,p):U(i)?m(i,f):I(i,c,f,p)}function r(s){return s._type in e.types}function a(s,i,c){const p=B({node:s,index:i,isInline:!1,renderNode:n}),f=e.listItem,k=(typeof f=="function"?f:f[s.listItem])||e.unknownListItem;if(k===e.unknownListItem){const d=s.listItem||"bullet";t(Z(d),{type:d,nodeType:"listItemStyle"})}let h=p.children;if(s.style&&s.style!=="normal"){const{listItem:d,...T}=s;h=n({node:T,index:i,isInline:!1})}return u.jsx(k,{value:s,index:i,isInline:!1,renderNode:n,children:h},c)}function l(s,i,c){const p=s.children.map((h,d)=>n({node:h._key?h:{...h,_key:`li-${i}-${d}`},index:d,isInline:!1})),f=e.list,k=(typeof f=="function"?f:f[s.listItem])||e.unknownList;if(k===e.unknownList){const h=s.listItem||"bullet";t(Y(h),{nodeType:"listStyle",type:h})}return u.jsx(k,{value:s,index:i,isInline:!1,renderNode:n,children:p},c)}function o(s,i,c){const{markDef:p,markType:f,markKey:k}=s,h=e.marks[f]||e.unknownMark,d=s.children.map((T,E)=>n({node:T,index:E,isInline:!0}));return h===e.unknownMark&&t(Q(f),{nodeType:"mark",type:f}),u.jsx(h,{text:A(s),value:p,markType:f,markKey:k,renderNode:n,children:d},c)}function y(s,i,c,p){const{_key:f,...k}=B({node:s,index:i,isInline:p,renderNode:n}),h=k.node.style||"normal",d=(typeof e.block=="function"?e.block:e.block[h])||e.unknownBlockStyle;return d===e.unknownBlockStyle&&t(X(h),{nodeType:"blockStyle",type:h}),u.jsx(d,{...k,value:k.node,renderNode:n},c)}function m(s,i){if(s.text===`
`){const c=e.hardBreak;return c?u.jsx(c,{},i):`
`}return s.text}function I(s,i,c,p){const f={value:s,isInline:p,index:i,renderNode:n};t(N(s._type),{nodeType:"block",type:s._type});const k=e.unknownType;return u.jsx(k,{...f},c)}function x(s,i,c,p){const f={value:s,isInline:p,index:i,renderNode:n},k=e.types[s._type];return k?u.jsx(k,{...f},c):null}return n};function B(e){const{node:t,index:n,isInline:r,renderNode:a}=e,l=C(t).map((o,y)=>a({node:o,isInline:!0,index:y,renderNode:a}));return{_key:t._key||`block-${n}`,children:l,index:n,isInline:r,node:t}}function ae(){}export{ye as P};
