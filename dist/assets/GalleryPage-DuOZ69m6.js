import{r as n,R as e,W as R,m as E,A as P}from"./index-CUeeWxzs.js";import{C as _}from"./cloudinaryImage-CcQh8T1W.js";const G=()=>{var N,k;const[r,b]=n.useState([]),[g,C]=n.useState(""),[S,w]=n.useState(!0),[x,p]=n.useState(null),[c,d]=n.useState(null),v=n.useRef(!1),L=n.useCallback(async()=>v.current?null:new Promise(t=>{const s=typeof window<"u"&&window.photoData,l=()=>{const o=window&&window.photoData||[];if(Array.isArray(o)&&o.length){const i=o.map((u,m)=>({asset_id:u.src||String(m),public_id:u.src||String(m),context:{alt:u.title||"Gallery image"},thumbnail_url:u.src,large_url:u.src}));v.current=!0,t(i)}else t(null)};if(s)return l();const a=document.createElement("script");a.src="/gallery/photos.js",a.async=!0,a.onload=l,a.onerror=()=>t(null),document.body.appendChild(a)}),[]),y=n.useRef(null);n.useEffect(()=>{const t=new AbortController,s=setTimeout(async()=>{w(!0),p(null);try{const l=`/api/search-images${g?`?query=${encodeURIComponent(g)}&per_page=${f}`:`?per_page=${f}`}`,a=await fetch(l,{signal:t.signal});if(!(a.headers.get("content-type")||"").includes("application/json")){const m=await a.text().catch(()=>""),T=m&&m.includes("<!DOCTYPE")?"API endpoint not found - got HTML instead of JSON":m||"Unexpected non-JSON response";throw new Error(T)}const i=await a.json();if(!a.ok){const m=i&&(i.error||i.details||JSON.stringify(i));throw new Error(`Search failed (${a.status}): ${m}`)}const u=Array.isArray(i.images)?i.images:[];b(u)}catch(l){if(l.name==="AbortError")return;console.error("Error fetching images:",l);try{const a=await L();a&&a.length?(b(a),p("Showing fallback images while the gallery API is unavailable.")):p(l.message||String(l))}catch{p(l.message||String(l))}}finally{w(!1)}},300);return()=>{clearTimeout(s),t.abort()}},[g]);const f=36,[A,j]=n.useState(f);n.useEffect(()=>j(f),[r]);const I=n.useCallback((t,s)=>{if(d({img:t,idx:s}),t&&t.large_url){const o=new Image;o.src=t.large_url}const l=(s+1)%r.length,a=r[l];if(a&&a.large_url){const o=new Image;o.src=a.large_url}},[d,r]),h=n.useCallback(()=>d(null),[d]);return n.useEffect(()=>{const t=s=>{if(c){if(s.key==="Escape"&&h(),s.key==="ArrowRight"){const l=(c.idx+1)%r.length;d({img:r[l],idx:l})}if(s.key==="ArrowLeft"){const l=(c.idx-1+r.length)%r.length;d({img:r[l],idx:l})}}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[c,r,h]),n.useEffect(()=>{c&&y.current&&y.current.focus()},[c]),e.createElement(e.Fragment,null,e.createElement(R,null,e.createElement("title",null,"pictures of food. | Local Effort"),e.createElement("meta",{name:"description",content:"A visual gallery of dinners, events, meal prep, and plates from Local Effort."}),e.createElement("script",{type:"application/ld+json"},JSON.stringify({"@context":"https://schema.org","@type":"Restaurant",name:"Local Effort",url:"https://local-effort-app.vercel.app/gallery",image:r.slice(0,8).map(t=>t.large_url||t.thumbnail_url).filter(Boolean),servesCuisine:["American","Local","Seasonal"],sameAs:[]}))),e.createElement("div",{className:"container mx-auto px-4 py-8"},e.createElement("h1",{className:"text-4xl font-bold mb-4 text-center"},"pictures of food."),e.createElement("input",{type:"text",value:g,onChange:t=>C(t.target.value),placeholder:"Search by tag (e.g., pizza, events, mealplan, plates, dinner, eggs)...",className:"w-full max-w-md mx-auto block p-3 border rounded-md mb-8"}),S?e.createElement("p",null,"Loading..."):x?e.createElement("div",{className:"text-red-600 bg-red-50 p-4 rounded"},e.createElement("h3",{className:"font-bold"},"Error Details:"),e.createElement("p",null,x),e.createElement("p",{className:"mt-2 text-sm"},"This usually means:"),e.createElement("ul",{className:"list-disc ml-6 text-sm"},e.createElement("li",null,"The /api/search-images.js file wasn't created properly"),e.createElement("li",null,"Environment variables aren't set in Vercel"),e.createElement("li",null,"The serverless function has an error")),e.createElement("p",{className:"mt-2 text-sm"},"Check the browser Network tab and Vercel function logs.")):r.length===0?e.createElement("div",{className:"text-center p-8"},e.createElement("p",null,"No images found."),e.createElement("p",{className:"text-sm text-gray-600 mt-2"},"Try removing search terms or check that you have images in your Cloudinary account.")):e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},r.slice(0,A).map((t,s)=>{var l,a,o;return e.createElement(E.button,{type:"button",key:t.asset_id,onClick:()=>I(t,s),whileHover:{scale:1.03},whileTap:{scale:.98},className:"border p-2 bg-white rounded-lg overflow-hidden","aria-label":((l=t.context)==null?void 0:l.alt)||`Gallery image ${s+1}`},t.thumbnail_url?e.createElement("img",{src:t.thumbnail_url,alt:((a=t.context)==null?void 0:a.alt)||"Gallery image",className:"rounded-lg object-cover w-full h-full aspect-square",loading:"lazy"}):e.createElement(_,{publicId:t.public_id,alt:((o=t.context)==null?void 0:o.alt)||"Gallery image",width:600,height:600,className:"rounded-lg object-cover w-full h-full aspect-square"}))}))),e.createElement(P,null,c&&e.createElement(E.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:h},e.createElement(E.div,{className:"max-w-5xl w-full max-h-full",initial:{y:20,scale:.98},animate:{y:0,scale:1},exit:{y:20,scale:.98},onClick:t=>t.stopPropagation()},e.createElement("div",{className:"relative overflow-hidden"},e.createElement("button",{ref:y,className:"absolute right-2 top-2 z-10 bg-black/60 text-white rounded-full p-2",onClick:h,"aria-label":"Close image"},"âœ•"),e.createElement("div",{className:"flex items-center justify-center p-2"},c.img.large_url?e.createElement("img",{src:c.img.large_url,alt:((N=c.img.context)==null?void 0:N.alt)||"Large gallery image",className:"w-full h-auto max-h-[90vh] object-contain"}):e.createElement(_,{publicId:c.img.public_id,alt:((k=c.img.context)==null?void 0:k.alt)||"Large gallery image",width:1400,height:1e3,disableLazy:!0,className:"w-full h-auto max-h-[90vh] object-contain"})))))))};export{G as default};
