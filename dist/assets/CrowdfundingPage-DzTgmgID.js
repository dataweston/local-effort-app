import{g as et,c as rt,r as L,R as n,P as h,W as at,d as Y}from"./index-DMXgV45R.js";import{P as I}from"./index-Bo31mduX.js";var K={exports:{}};(function(o,x){(function(v,E){o.exports=E()})(rt,function(){function v(r,e){(e==null||e>r.length)&&(e=r.length);for(var a=0,t=Array(e);a<e;a++)t[a]=r[a];return t}function E(r,e){var a=typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(a)return(a=a.call(r)).next.bind(a);if(Array.isArray(r)||(a=H(r))||e){a&&(r=a);var t=0;return function(){return t>=r.length?{done:!0}:{done:!1,value:r[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u(){return u=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var t in a)({}).hasOwnProperty.call(a,t)&&(r[t]=a[t])}return r},u.apply(null,arguments)}function H(r,e){if(r){if(typeof r=="string")return v(r,e);var a={}.toString.call(r).slice(8,-1);return a==="Object"&&r.constructor&&(a=r.constructor.name),a==="Map"||a==="Set"?Array.from(r):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?v(r,e):void 0}}var b="image-Tb9Ew8CXIwaY6R1kjMvI0uRR-2000x3000-jpg";function W(r){var e=r.split("-"),a=e[1],t=e[2],c=e[3];if(!a||!t||!c)throw new Error("Malformed asset _ref '"+r+`'. Expected an id like "`+b+'".');var i=t.split("x"),l=i[0],p=i[1],g=+l,f=+p,m=isFinite(g)&&isFinite(f);if(!m)throw new Error("Malformed asset _ref '"+r+`'. Expected an id like "`+b+'".');return{id:a,width:g,height:f,format:c}}var C=function(e){var a=e;return a?typeof a._ref=="string":!1},A=function(e){var a=e;return a?typeof a._id=="string":!1},_=function(e){var a=e;return a&&a.asset?typeof a.asset.url=="string":!1},q=function(e){if(typeof e=="object"&&e!==null){var a=e;return a._upload&&(!a.asset||!a.asset._ref)}return!1};function D(r){if(!r)return null;var e;if(typeof r=="string"&&V(r))e={asset:{_ref:U(r)}};else if(typeof r=="string")e={asset:{_ref:r}};else if(C(r))e={asset:r};else if(A(r))e={asset:{_ref:r._id||""}};else if(_(r))e={asset:{_ref:U(r.asset.url)}};else if(typeof r.asset=="object")e=u({},r);else return null;var a=r;return a.crop&&(e.crop=a.crop),a.hotspot&&(e.hotspot=a.hotspot),k(e)}function V(r){return/^https?:\/\//.test(""+r)}function U(r){var e=r.split("/").slice(-1);return("image-"+e[0]).replace(/\.([a-z]+)$/,"-$1")}function k(r){if(r.crop&&r.hotspot)return r;var e=u({},r);return e.crop||(e.crop={left:0,top:0,bottom:0,right:0}),e.hotspot||(e.hotspot={x:.5,y:.5,height:1,width:1}),e}var F=[["width","w"],["height","h"],["format","fm"],["download","dl"],["blur","blur"],["sharpen","sharp"],["invert","invert"],["orientation","or"],["minHeight","min-h"],["maxHeight","max-h"],["minWidth","min-w"],["maxWidth","max-w"],["quality","q"],["fit","fit"],["crop","crop"],["saturation","sat"],["auto","auto"],["dpr","dpr"],["pad","pad"],["frame","frame"]];function M(r){var e=u({},r||{}),a=e.source;delete e.source;var t=D(a);if(!t){if(a&&q(a))return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8HwQACfsD/QNViZkAAAAASUVORK5CYII=";throw new Error("Unable to resolve image URL from source ("+JSON.stringify(a)+")")}var c=t.asset._ref||t.asset._id||"",i=W(c),l=Math.round(t.crop.left*i.width),p=Math.round(t.crop.top*i.height),g={left:l,top:p,width:Math.round(i.width-t.crop.right*i.width-l),height:Math.round(i.height-t.crop.bottom*i.height-p)},f=t.hotspot.height*i.height/2,m=t.hotspot.width*i.width/2,z=t.hotspot.x*i.width,O=t.hotspot.y*i.height,y={left:z-m,top:O-f,right:z+m,bottom:O+f};return e.rect||e.focalPoint||e.ignoreImageParams||e.crop||(e=u({},e,P({crop:g,hotspot:y},e))),$(u({},e,{asset:i}))}function $(r){var e=(r.baseUrl||"https://cdn.sanity.io").replace(/\/+$/,""),a=r.vanityName?"/"+r.vanityName:"",t=r.asset.id+"-"+r.asset.width+"x"+r.asset.height+"."+r.asset.format+a,c=e+"/images/"+r.projectId+"/"+r.dataset+"/"+t,i=[];if(r.rect){var l=r.rect,p=l.left,g=l.top,f=l.width,m=l.height,z=p!==0||g!==0||m!==r.asset.height||f!==r.asset.width;z&&i.push("rect="+p+","+g+","+f+","+m)}r.bg&&i.push("bg="+r.bg),r.focalPoint&&(i.push("fp-x="+r.focalPoint.x),i.push("fp-y="+r.focalPoint.y));var O=[r.flipHorizontal&&"h",r.flipVertical&&"v"].filter(Boolean).join("");return O&&i.push("flip="+O),F.forEach(function(y){var R=y[0],w=y[1];typeof r[R]<"u"?i.push(w+"="+encodeURIComponent(r[R])):typeof r[w]<"u"&&i.push(w+"="+encodeURIComponent(r[w]))}),i.length===0?c:c+"?"+i.join("&")}function P(r,e){var a,t=e.width,c=e.height;if(!(t&&c))return{width:t,height:c,rect:r.crop};var i=r.crop,l=r.hotspot,p=t/c,g=i.width/i.height;if(g>p){var f=Math.round(i.height),m=Math.round(f*p),z=Math.max(0,Math.round(i.top)),O=Math.round((l.right-l.left)/2+l.left),y=Math.max(0,Math.round(O-m/2));y<i.left?y=i.left:y+m>i.left+i.width&&(y=i.left+i.width-m),a={left:y,top:z,width:m,height:f}}else{var R=i.width,w=Math.round(R/p),Z=Math.max(0,Math.round(i.left)),tt=Math.round((l.bottom-l.top)/2+l.top),j=Math.max(0,Math.round(tt-w/2));j<i.top?j=i.top:j+w>i.top+i.height&&(j=i.top+i.height-w),a={left:Z,top:j,width:R,height:w}}return{width:t,height:c,rect:a}}var T=["clip","crop","fill","fillmax","max","scale","min"],G=["top","bottom","left","right","center","focalpoint","entropy"],S=["format"];function Q(r){return r&&"config"in r?typeof r.config=="function":!1}function B(r){return r&&"clientConfig"in r?typeof r.clientConfig=="object":!1}function s(r){for(var e=F,a=E(e),t;!(t=a()).done;){var c=t.value,i=c[0],l=c[1];if(r===i||r===l)return i}return r}function d(r){if(Q(r)){var e=r.config(),a=e.apiHost,t=e.projectId,c=e.dataset,i=a||"https://api.sanity.io";return new N(null,{baseUrl:i.replace(/^https:\/\/api\./,"https://cdn."),projectId:t,dataset:c})}if(B(r)){var l=r.clientConfig,p=l.apiHost,g=l.projectId,f=l.dataset,m=p||"https://api.sanity.io";return new N(null,{baseUrl:m.replace(/^https:\/\/api\./,"https://cdn."),projectId:g,dataset:f})}return new N(null,r||{})}var N=function(){function r(a,t){this.options=void 0,this.options=a?u({},a.options||{},t||{}):u({},t||{})}var e=r.prototype;return e.withOptions=function(t){var c=t.baseUrl||this.options.baseUrl,i={baseUrl:c};for(var l in t)if(t.hasOwnProperty(l)){var p=s(l);i[p]=t[l]}return new r(this,u({baseUrl:c},i))},e.image=function(t){return this.withOptions({source:t})},e.dataset=function(t){return this.withOptions({dataset:t})},e.projectId=function(t){return this.withOptions({projectId:t})},e.bg=function(t){return this.withOptions({bg:t})},e.dpr=function(t){return this.withOptions(t&&t!==1?{dpr:t}:{})},e.width=function(t){return this.withOptions({width:t})},e.height=function(t){return this.withOptions({height:t})},e.focalPoint=function(t,c){return this.withOptions({focalPoint:{x:t,y:c}})},e.maxWidth=function(t){return this.withOptions({maxWidth:t})},e.minWidth=function(t){return this.withOptions({minWidth:t})},e.maxHeight=function(t){return this.withOptions({maxHeight:t})},e.minHeight=function(t){return this.withOptions({minHeight:t})},e.size=function(t,c){return this.withOptions({width:t,height:c})},e.blur=function(t){return this.withOptions({blur:t})},e.sharpen=function(t){return this.withOptions({sharpen:t})},e.rect=function(t,c,i,l){return this.withOptions({rect:{left:t,top:c,width:i,height:l}})},e.format=function(t){return this.withOptions({format:t})},e.invert=function(t){return this.withOptions({invert:t})},e.orientation=function(t){return this.withOptions({orientation:t})},e.quality=function(t){return this.withOptions({quality:t})},e.forceDownload=function(t){return this.withOptions({download:t})},e.flipHorizontal=function(){return this.withOptions({flipHorizontal:!0})},e.flipVertical=function(){return this.withOptions({flipVertical:!0})},e.ignoreImageParams=function(){return this.withOptions({ignoreImageParams:!0})},e.fit=function(t){if(T.indexOf(t)===-1)throw new Error('Invalid fit mode "'+t+'"');return this.withOptions({fit:t})},e.crop=function(t){if(G.indexOf(t)===-1)throw new Error('Invalid crop mode "'+t+'"');return this.withOptions({crop:t})},e.saturation=function(t){return this.withOptions({saturation:t})},e.auto=function(t){if(S.indexOf(t)===-1)throw new Error('Invalid auto mode "'+t+'"');return this.withOptions({auto:t})},e.pad=function(t){return this.withOptions({pad:t})},e.vanityName=function(t){return this.withOptions({vanityName:t})},e.frame=function(t){if(t!==1)throw new Error('Invalid frame value "'+t+'"');return this.withOptions({frame:t})},e.url=function(){return M(this.options)},e.toString=function(){return this.url()},r}();return d})})(K);var nt=K.exports;const it=et(nt),ot=it(Y);function st(o){return ot.image(o)}const J=({value:o,label:x})=>n.createElement("div",null,n.createElement("p",{className:"text-3xl font-bold"},o),n.createElement("p",{className:"text-gray-600"},x));J.propTypes={value:h.oneOfType([h.string,h.number]).isRequired,label:h.string.isRequired};const X=({tier:o})=>{if(!o)return null;const x=o.pieCount?`${o.pieCount.toLocaleString()} pies`:null,v=o.pizzaCount?`${o.pizzaCount.toLocaleString()} pizzas`:null,E=o.amount?`$${o.amount.toLocaleString()}`:null;return n.createElement("div",{className:"card p-6 border hover:border-[var(--color-accent)] transition-colors"},n.createElement("p",{className:"text-2xl font-bold"},x?`${x} — ${o.title}`:v?`${v} — ${o.title}`:`Pledge ${E||"$0"} or more`),!v&&n.createElement("h4",{className:"text-xl font-bold text-[var(--color-accent)] mt-1"},o.title),n.createElement("p",{className:"text-body text-gray-600 my-3"},o.description),o.limit&&n.createElement("p",{className:"text-sm font-semibold text-gray-500 mb-3"},"LIMITED (",o.limit," left)"),n.createElement("button",{className:"btn btn-secondary w-full"},"Select this reward"))};X.propTypes={tier:h.shape({pizzaCount:h.number,pieCount:h.number,amount:h.number,title:h.string,description:h.string,limit:h.number})};const ut=()=>{const[o,x]=L.useState(null),[v,E]=L.useState(!0),[u,H]=L.useState(null),[b,W]=L.useState("story");if(L.useEffect(()=>{const s="local-pizza-by-local-effort-let-s-make-1000-pizzas",d=`*[_type == "crowdfundingCampaign" && slug.current == $slug][0]{
      title,
      // Short description: prefer new field name, fallback to legacy if present
      "description": coalesce(description, shortDescription),
      // pizza-specific fields (keep legacy fields for backwards compatibility)
      pizzaGoal,
      pizzasSold,
      piesSold,
      goal,
      raisedAmount,
      backers,
      endDate,
      heroImage,
      story,
      goals,
      faq,
      "rewardTiers": rewardTiers[]->{ amount, pizzaCount, title, description, limit } | order(amount asc),
      "updates": updates[]->{ title, publishedAt, body } | order(publishedAt desc)
    }`,N={slug:s};(async()=>{try{const e=await Y.fetch(d,N);x(e)}catch(e){try{const a=e&&e.message?e.message:String(e);if(console.error("Sanity fetch error message:",a),e&&e.response&&typeof e.response.text=="function"){const t=await e.response.text();console.error("Sanity fetch response body:",t)}}catch(a){console.error("Error while logging Sanity error:",a)}try{const t=await Y.fetch(`*[_type == "crowdfundingCampaign"][0]{
            title,
            "description": coalesce(description, shortDescription),
            pizzaGoal,
            pizzasSold,
            piesSold,
            goal,
            raisedAmount,
            backers,
            endDate,
            heroImage,
            story,
            goals,
            faq,
            "rewardTiers": rewardTiers[]->{ amount, pizzaCount, title, description, limit } | order(amount asc),
            "updates": updates[]->{ title, publishedAt, body } | order(publishedAt desc)
          }`);if(t){console.warn("Loaded fallback campaign (first in dataset)"),x(t),H(null);return}}catch(a){console.error("Fallback fetch also failed:",a&&(a.message||a))}H("Failed to load campaign data.")}finally{E(!1)}})()},[]),v)return n.createElement("div",{className:"text-center p-12"},"Loading campaign...");if(u){const s=typeof u=="string"?u:u&&(u.message||JSON.stringify(u))||"Failed to load campaign data.";return n.createElement("div",{className:"text-center p-12 text-red-600"},s)}if(!o)return n.createElement("div",{className:"text-center p-12"},"No campaign found. Have you created and published it in Sanity Studio?");const{title:C="Untitled Campaign",description:A=[],backers:_=0,endDate:q=null,heroImage:D=null}=o,V=o.piesSold??0,U=o.story||[],k=o.faq||[],F=o.rewardTiers||[],M=o.updates||[],$=(o.pizzasSold??o.raisedAmount)||0,P=(o.pizzaGoal??o.goal)||1e3,T=q?Math.ceil((new Date(q)-new Date)/(1e3*60*60*24)):0,G=P>0?Math.min($/P*100,100):0,S=({tabName:s,label:d})=>n.createElement("button",{type:"button",onClick:()=>W(s),"aria-pressed":b===s,className:`pb-2 px-1 text-lg font-semibold transition-colors ${b===s?"border-b-2 border-[var(--color-accent)] text-gray-900":"text-gray-500 hover:text-gray-800"}`},d);S.propTypes={tabName:h.string.isRequired,label:h.string.isRequired};const Q=s=>s?typeof s=="string"?s:(s||[]).filter(Boolean).map(d=>typeof d=="string"?d:d.children&&Array.isArray(d.children)?d.children.map(N=>N.text||"").join(""):"").join(`
`).trim():"",B=s=>Array.isArray(s)?s:s?[{_type:"block",style:"normal",children:[{_type:"span",text:typeof s=="string"?s:String(s)}]}]:[];return n.createElement(n.Fragment,null,n.createElement(at,null,n.createElement("title",null,`${C} | Crowdfunding Campaign`),n.createElement("meta",{name:"description",content:Q(A).slice(0,160)})),n.createElement("div",{className:"space-y-16 mx-auto max-w-6xl px-4 md:px-6 lg:px-8"},n.createElement("div",null,n.createElement("h1",{className:"text-4xl md:text-6xl font-bold uppercase tracking-[-0.02em] leading-[1.02]"},C),n.createElement("div",{className:"mt-6 md:mt-8 text-body max-w-2xl"},A&&(Array.isArray(A)?n.createElement(I,{value:A}):n.createElement(I,{value:B(A)})))),n.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-5 lg:gap-16"},n.createElement("div",{className:"lg:col-span-3 space-y-8"},D&&n.createElement("img",{src:st(D).width(1200).quality(80).url(),alt:C,className:"w-full object-cover rounded-lg aspect-video bg-gray-100"}),n.createElement("div",{className:"border-b border-gray-200"},n.createElement("nav",{className:"flex space-x-8"},n.createElement(S,{tabName:"story",label:"Our Story"}),M.length>0&&n.createElement(S,{tabName:"updates",label:`Updates (${M.length})`}),n.createElement(S,{tabName:"goals",label:"Goals"}),k.length>0&&n.createElement(S,{tabName:"faq",label:"FAQ"}))),n.createElement("div",{className:"prose max-w-none text-body"},b==="story"&&U.length>0&&n.createElement(I,{value:U}),b==="updates"&&n.createElement("div",{className:"space-y-8"},M.map((s,d)=>n.createElement("div",{key:d,className:"p-4 border-l-4 border-gray-200"},n.createElement("h3",{className:"text-heading mt-0"},s.title),n.createElement("p",{className:"text-sm text-gray-500 mb-2"},new Date(s.publishedAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})),n.createElement(I,{value:s.body})))),b==="goals"&&n.createElement("div",{className:"space-y-6"},o.goals?Array.isArray(o.goals)?n.createElement(I,{value:o.goals}):n.createElement(I,{value:B(o.goals)}):n.createElement("p",{className:"text-gray-500"},"No goals content yet. Add content in the Goals field in Sanity Studio.")),b==="faq"&&n.createElement("div",{className:"space-y-6"},k.map((s,d)=>n.createElement("div",{key:d},n.createElement("h4",{className:"font-bold text-lg mb-1"},s.question),n.createElement("p",{className:"mt-0"},s.answer)))))),n.createElement("div",{className:"lg:col-span-2 space-y-8 mt-12 lg:mt-0"},n.createElement("div",{className:"card p-6 space-y-4"},n.createElement("div",{className:"w-full bg-gray-200 rounded-full h-2.5"},n.createElement("div",{className:"bg-[var(--color-accent)] h-2.5 rounded-full",style:{width:`${G}%`}})),n.createElement("div",null,n.createElement("p",{className:"text-4xl font-bold text-[var(--color-accent)]"},$.toLocaleString()," pizzas"),n.createElement("p",{className:"text-body text-gray-600"},"sold of ",P.toLocaleString()," pizzas goal"),n.createElement("p",{className:"mt-2 text-2xl font-semibold"},V.toLocaleString()," pies"),n.createElement("p",{className:"text-body text-gray-600"},"sold")),n.createElement("div",{className:"flex justify-between text-body text-center border-y py-3"},n.createElement(J,{value:_.toLocaleString(),label:"backers"}),n.createElement(J,{value:T>0?T:"Ended",label:T>0?"days to go":""})),n.createElement("button",{className:"btn btn-primary w-full text-lg py-3"},"Order a pizza")),n.createElement("div",{className:"space-y-4"},n.createElement("h3",{className:"text-heading uppercase"},"Support Us"),F.map(s=>n.createElement(X,{key:(s==null?void 0:s.title)||Math.random(),tier:s})))))))};export{ut as default};
