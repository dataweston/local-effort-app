import{r,R as e,W as j,m as y,A as R}from"./index-B4cIQvsT.js";import{C}from"./cloudinaryImage-CJ6RoUlG.js";const z=()=>{var N,k;const[c,b]=r.useState([]),[d,S]=r.useState(""),[_,E]=r.useState(!0),[w,g]=r.useState(null),[o,u]=r.useState(null),x=r.useRef(!1),L=r.useCallback(async()=>x.current?null:new Promise(t=>{const s=typeof window<"u"&&window.photoData,a=()=>{const n=window&&window.photoData||[];if(Array.isArray(n)&&n.length){const h=n.map((i,m)=>({asset_id:i.src||String(m),public_id:i.src||String(m),context:{alt:i.title||"Gallery image"},thumbnail_url:i.src,large_url:i.src}));x.current=!0,t(h)}else t(null)};if(s)return a();const l=document.createElement("script");l.src="/gallery/photos.js",l.async=!0,l.onload=a,l.onerror=()=>t(null),document.body.appendChild(l)}),[]),p=r.useRef(null);r.useEffect(()=>{let t=null;const s=setTimeout(async()=>{E(!0),g(null);try{t=new AbortController;const{signal:a}=t,l=`/api/search-images${d?`?query=${encodeURIComponent(d)}`:""}`,n=await fetch(l,{signal:a}),h=n.headers.get("content-type");if(!h||!h.includes("application/json")){const m=await n.text();throw console.error("Non-JSON response (truncated):",m.substring(0,200)),new Error("API endpoint not found - got HTML instead of JSON")}const i=await n.json();if(!n.ok){const m=i&&(i.error||i.details||JSON.stringify(i));throw new Error(`Search failed (${n.status}): ${m}`)}b(i.images||[])}catch(a){if(a.name==="AbortError")return;console.error("Error fetching images:",a);try{const l=await L();l&&l.length?(b(l),g("Showing fallback images while the gallery API is unavailable.")):g(a.message||String(a))}catch{g(a.message||String(a))}}finally{E(!1)}},500);return()=>{clearTimeout(s),t&&t.abort()}},[d]);const v=24,[T,I]=r.useState(v);r.useEffect(()=>I(v),[c]);const A=r.useCallback((t,s)=>{if(u({img:t,idx:s}),t&&t.large_url){const n=new Image;n.src=t.large_url}const a=(s+1)%c.length,l=c[a];if(l&&l.large_url){const n=new Image;n.src=l.large_url}},[u,c]),f=r.useCallback(()=>u(null),[u]);return r.useEffect(()=>{const t=s=>{if(o){if(s.key==="Escape"&&f(),s.key==="ArrowRight"){const a=(o.idx+1)%c.length;u({img:c[a],idx:a})}if(s.key==="ArrowLeft"){const a=(o.idx-1+c.length)%c.length;u({img:c[a],idx:a})}}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[o,c,f]),r.useEffect(()=>{o&&p.current&&p.current.focus()},[o]),e.createElement(e.Fragment,null,e.createElement(j,null,e.createElement("title",null,"Pictures of Food | Local Effort")),e.createElement("div",{className:"container mx-auto px-4 py-8"},e.createElement("h1",{className:"text-4xl font-bold mb-4 text-center"},"Image Gallery"),e.createElement("input",{type:"text",value:d,onChange:t=>S(t.target.value),placeholder:"Search by tag (e.g., pizza, events)...",className:"w-full max-w-md mx-auto block p-3 border rounded-md mb-8"}),_?e.createElement("p",null,"Loading..."):w?e.createElement("div",{className:"text-red-600 bg-red-50 p-4 rounded"},e.createElement("h3",{className:"font-bold"},"Error Details:"),e.createElement("p",null,w),e.createElement("p",{className:"mt-2 text-sm"},"This usually means:"),e.createElement("ul",{className:"list-disc ml-6 text-sm"},e.createElement("li",null,"The /api/search-images.js file wasn't created properly"),e.createElement("li",null,"Environment variables aren't set in Vercel"),e.createElement("li",null,"The serverless function has an error")),e.createElement("p",{className:"mt-2 text-sm"},"Check the browser Network tab and Vercel function logs.")):c.length===0?e.createElement("div",{className:"text-center p-8"},e.createElement("p",null,"No images found."),e.createElement("p",{className:"text-sm text-gray-600 mt-2"},"Try removing search terms or check that you have images in your Cloudinary account.")):e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},c.map((t,s)=>{var a,l,n;return e.createElement(y.button,{type:"button",key:t.asset_id,onClick:()=>A(t,s),whileHover:{scale:1.03},whileTap:{scale:.98},className:"border p-2 bg-white rounded-lg overflow-hidden","aria-label":((a=t.context)==null?void 0:a.alt)||`Gallery image ${s+1}`},t.thumbnail_url?e.createElement("img",{src:t.thumbnail_url,alt:((l=t.context)==null?void 0:l.alt)||"Gallery image",className:"rounded-lg object-cover w-full h-full aspect-square",loading:"lazy"}):e.createElement(C,{publicId:t.public_id,alt:((n=t.context)==null?void 0:n.alt)||"Gallery image",width:600,height:600,className:"rounded-lg object-cover w-full h-full aspect-square"}))}))),e.createElement(R,null,o&&e.createElement(y.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:f},e.createElement(y.div,{className:"max-w-5xl w-full max-h-full",initial:{y:20,scale:.98},animate:{y:0,scale:1},exit:{y:20,scale:.98},onClick:t=>t.stopPropagation()},e.createElement("div",{className:"relative overflow-hidden"},e.createElement("button",{ref:p,className:"absolute right-2 top-2 z-10 bg-black/60 text-white rounded-full p-2",onClick:f,"aria-label":"Close image"},"âœ•"),e.createElement("div",{className:"flex items-center justify-center p-2"},o.img.large_url?e.createElement("img",{src:o.img.large_url,alt:((N=o.img.context)==null?void 0:N.alt)||"Large gallery image",className:"w-full h-auto max-h-[90vh] object-contain"}):e.createElement(C,{publicId:o.img.public_id,alt:((k=o.img.context)==null?void 0:k.alt)||"Large gallery image",width:1400,height:1e3,disableLazy:!0,className:"w-full h-auto max-h-[90vh] object-contain"})))))))};export{z as default};
