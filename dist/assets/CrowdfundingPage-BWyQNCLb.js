import{g as et,c as at,r as b,R as n,P as y,W as rt,d as Q}from"./index-DsxBSm8k.js";import{P as C}from"./index-RQSmRrbC.js";var K={exports:{}};(function(s,E){(function(S,x){s.exports=x()})(at,function(){function S(t,a){(a==null||a>t.length)&&(a=t.length);for(var r=0,e=Array(a);r<a;r++)e[r]=t[r];return e}function x(t,a){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=O(t))||a){r&&(t=r);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function d(){return d=Object.assign?Object.assign.bind():function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var e in r)({}).hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t},d.apply(null,arguments)}function O(t,a){if(t){if(typeof t=="string")return S(t,a);var r={}.toString.call(t).slice(8,-1);return r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set"?Array.from(t):r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(t,a):void 0}}var v="image-Tb9Ew8CXIwaY6R1kjMvI0uRR-2000x3000-jpg";function B(t){var a=t.split("-"),r=a[1],e=a[2],c=a[3];if(!r||!e||!c)throw new Error("Malformed asset _ref '"+t+`'. Expected an id like "`+v+'".');var o=e.split("x"),u=o[0],i=o[1],l=+u,m=+i,p=isFinite(l)&&isFinite(m);if(!p)throw new Error("Malformed asset _ref '"+t+`'. Expected an id like "`+v+'".');return{id:r,width:l,height:m,format:c}}var j=function(a){var r=a;return r?typeof r._ref=="string":!1},L=function(a){var r=a;return r?typeof r._id=="string":!1},R=function(a){var r=a;return r&&r.asset?typeof r.asset.url=="string":!1},k=function(a){if(typeof a=="object"&&a!==null){var r=a;return r._upload&&(!r.asset||!r.asset._ref)}return!1};function H(t){if(!t)return null;var a;if(typeof t=="string"&&W(t))a={asset:{_ref:P(t)}};else if(typeof t=="string")a={asset:{_ref:t}};else if(j(t))a={asset:t};else if(L(t))a={asset:{_ref:t._id||""}};else if(R(t))a={asset:{_ref:P(t.asset.url)}};else if(typeof t.asset=="object")a=d({},t);else return null;var r=t;return r.crop&&(a.crop=r.crop),r.hotspot&&(a.hotspot=r.hotspot),V(a)}function W(t){return/^https?:\/\//.test(""+t)}function P(t){var a=t.split("/").slice(-1);return("image-"+a[0]).replace(/\.([a-z]+)$/,"-$1")}function V(t){if(t.crop&&t.hotspot)return t;var a=d({},t);return a.crop||(a.crop={left:0,top:0,bottom:0,right:0}),a.hotspot||(a.hotspot={x:.5,y:.5,height:1,width:1}),a}var z=[["width","w"],["height","h"],["format","fm"],["download","dl"],["blur","blur"],["sharpen","sharp"],["invert","invert"],["orientation","or"],["minHeight","min-h"],["maxHeight","max-h"],["minWidth","min-w"],["maxWidth","max-w"],["quality","q"],["fit","fit"],["crop","crop"],["saturation","sat"],["auto","auto"],["dpr","dpr"],["pad","pad"],["frame","frame"]];function I(t){var a=d({},t||{}),r=a.source;delete a.source;var e=H(r);if(!e){if(r&&k(r))return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8HwQACfsD/QNViZkAAAAASUVORK5CYII=";throw new Error("Unable to resolve image URL from source ("+JSON.stringify(r)+")")}var c=e.asset._ref||e.asset._id||"",o=B(c),u=Math.round(e.crop.left*o.width),i=Math.round(e.crop.top*o.height),l={left:u,top:i,width:Math.round(o.width-e.crop.right*o.width-u),height:Math.round(o.height-e.crop.bottom*o.height-i)},m=e.hotspot.height*o.height/2,p=e.hotspot.width*o.width/2,f=e.hotspot.x*o.width,h=e.hotspot.y*o.height,g={left:f-p,top:h-m,right:f+p,bottom:h+m};return a.rect||a.focalPoint||a.ignoreImageParams||a.crop||(a=d({},a,N({crop:l,hotspot:g},a))),M(d({},a,{asset:o}))}function M(t){var a=(t.baseUrl||"https://cdn.sanity.io").replace(/\/+$/,""),r=t.vanityName?"/"+t.vanityName:"",e=t.asset.id+"-"+t.asset.width+"x"+t.asset.height+"."+t.asset.format+r,c=a+"/images/"+t.projectId+"/"+t.dataset+"/"+e,o=[];if(t.rect){var u=t.rect,i=u.left,l=u.top,m=u.width,p=u.height,f=i!==0||l!==0||p!==t.asset.height||m!==t.asset.width;f&&o.push("rect="+i+","+l+","+m+","+p)}t.bg&&o.push("bg="+t.bg),t.focalPoint&&(o.push("fp-x="+t.focalPoint.x),o.push("fp-y="+t.focalPoint.y));var h=[t.flipHorizontal&&"h",t.flipVertical&&"v"].filter(Boolean).join("");return h&&o.push("flip="+h),z.forEach(function(g){var U=g[0],w=g[1];typeof t[U]<"u"?o.push(w+"="+encodeURIComponent(t[U])):typeof t[w]<"u"&&o.push(w+"="+encodeURIComponent(t[w]))}),o.length===0?c:c+"?"+o.join("&")}function N(t,a){var r,e=a.width,c=a.height;if(!(e&&c))return{width:e,height:c,rect:t.crop};var o=t.crop,u=t.hotspot,i=e/c,l=o.width/o.height;if(l>i){var m=Math.round(o.height),p=Math.round(m*i),f=Math.max(0,Math.round(o.top)),h=Math.round((u.right-u.left)/2+u.left),g=Math.max(0,Math.round(h-p/2));g<o.left?g=o.left:g+p>o.left+o.width&&(g=o.left+o.width-p),r={left:g,top:f,width:p,height:m}}else{var U=o.width,w=Math.round(U/i),Z=Math.max(0,Math.round(o.left)),tt=Math.round((u.bottom-u.top)/2+u.top),T=Math.max(0,Math.round(tt-w/2));T<o.top?T=o.top:T+w>o.top+o.height&&(T=o.top+o.height-w),r={left:Z,top:T,width:U,height:w}}return{width:e,height:c,rect:r}}var G=["clip","crop","fill","fillmax","max","scale","min"],q=["top","bottom","left","right","center","focalpoint","entropy"],F=["format"];function J(t){return t&&"config"in t?typeof t.config=="function":!1}function _(t){return t&&"clientConfig"in t?typeof t.clientConfig=="object":!1}function D(t){for(var a=z,r=x(a),e;!(e=r()).done;){var c=e.value,o=c[0],u=c[1];if(t===o||t===u)return o}return t}function $(t){if(J(t)){var a=t.config(),r=a.apiHost,e=a.projectId,c=a.dataset,o=r||"https://api.sanity.io";return new A(null,{baseUrl:o.replace(/^https:\/\/api\./,"https://cdn."),projectId:e,dataset:c})}if(_(t)){var u=t.clientConfig,i=u.apiHost,l=u.projectId,m=u.dataset,p=i||"https://api.sanity.io";return new A(null,{baseUrl:p.replace(/^https:\/\/api\./,"https://cdn."),projectId:l,dataset:m})}return new A(null,t||{})}var A=function(){function t(r,e){this.options=void 0,this.options=r?d({},r.options||{},e||{}):d({},e||{})}var a=t.prototype;return a.withOptions=function(e){var c=e.baseUrl||this.options.baseUrl,o={baseUrl:c};for(var u in e)if(e.hasOwnProperty(u)){var i=D(u);o[i]=e[u]}return new t(this,d({baseUrl:c},o))},a.image=function(e){return this.withOptions({source:e})},a.dataset=function(e){return this.withOptions({dataset:e})},a.projectId=function(e){return this.withOptions({projectId:e})},a.bg=function(e){return this.withOptions({bg:e})},a.dpr=function(e){return this.withOptions(e&&e!==1?{dpr:e}:{})},a.width=function(e){return this.withOptions({width:e})},a.height=function(e){return this.withOptions({height:e})},a.focalPoint=function(e,c){return this.withOptions({focalPoint:{x:e,y:c}})},a.maxWidth=function(e){return this.withOptions({maxWidth:e})},a.minWidth=function(e){return this.withOptions({minWidth:e})},a.maxHeight=function(e){return this.withOptions({maxHeight:e})},a.minHeight=function(e){return this.withOptions({minHeight:e})},a.size=function(e,c){return this.withOptions({width:e,height:c})},a.blur=function(e){return this.withOptions({blur:e})},a.sharpen=function(e){return this.withOptions({sharpen:e})},a.rect=function(e,c,o,u){return this.withOptions({rect:{left:e,top:c,width:o,height:u}})},a.format=function(e){return this.withOptions({format:e})},a.invert=function(e){return this.withOptions({invert:e})},a.orientation=function(e){return this.withOptions({orientation:e})},a.quality=function(e){return this.withOptions({quality:e})},a.forceDownload=function(e){return this.withOptions({download:e})},a.flipHorizontal=function(){return this.withOptions({flipHorizontal:!0})},a.flipVertical=function(){return this.withOptions({flipVertical:!0})},a.ignoreImageParams=function(){return this.withOptions({ignoreImageParams:!0})},a.fit=function(e){if(G.indexOf(e)===-1)throw new Error('Invalid fit mode "'+e+'"');return this.withOptions({fit:e})},a.crop=function(e){if(q.indexOf(e)===-1)throw new Error('Invalid crop mode "'+e+'"');return this.withOptions({crop:e})},a.saturation=function(e){return this.withOptions({saturation:e})},a.auto=function(e){if(F.indexOf(e)===-1)throw new Error('Invalid auto mode "'+e+'"');return this.withOptions({auto:e})},a.pad=function(e){return this.withOptions({pad:e})},a.vanityName=function(e){return this.withOptions({vanityName:e})},a.frame=function(e){if(e!==1)throw new Error('Invalid frame value "'+e+'"');return this.withOptions({frame:e})},a.url=function(){return I(this.options)},a.toString=function(){return this.url()},t}();return $})})(K);var nt=K.exports;const it=et(nt),ot=it(Q);function st(s){return ot.image(s)}const Y=({value:s,label:E})=>n.createElement("div",null,n.createElement("p",{className:"text-3xl font-bold"},s),n.createElement("p",{className:"text-gray-600"},E));Y.propTypes={value:y.oneOfType([y.string,y.number]).isRequired,label:y.string.isRequired};const X=({tier:s,onContribute:E,busy:S})=>{if(!s)return null;const x=s.pieCount?`${s.pieCount.toLocaleString()} pies`:null,d=s.pizzaCount?`${s.pizzaCount.toLocaleString()} pizzas`:null,O=s.amount?`$${s.amount.toLocaleString()}`:null;return n.createElement("div",{className:"card p-6 border hover:border-[var(--color-accent)] transition-colors"},n.createElement("p",{className:"text-2xl font-bold"},x?`${x} — ${s.title}`:d?`${d} — ${s.title}`:`Pledge ${O||"$0"} or more`),!d&&n.createElement("h4",{className:"text-xl font-bold text-[var(--color-accent)] mt-1"},s.title),n.createElement("p",{className:"text-body text-gray-600 my-3"},s.description),s.limit&&n.createElement("p",{className:"text-sm font-semibold text-gray-500 mb-3"},"LIMITED (",s.limit," left)"),n.createElement("button",{className:"btn btn-secondary w-full disabled:opacity-60",disabled:S||!(typeof s.amount=="number"&&s.amount>0),onClick:()=>{typeof s.amount=="number"&&s.amount>0&&E({name:s.title||"Pledge",price:s.amount})}},typeof s.amount=="number"?`Contribute $${s.amount.toLocaleString()}`:"Unavailable online"))};X.propTypes={tier:y.shape({pizzaCount:y.number,pieCount:y.number,amount:y.number,title:y.string,description:y.string,limit:y.number})};const ut=()=>{const[s,E]=b.useState(null),[S,x]=b.useState(!0),[d,O]=b.useState(null),[v,B]=b.useState("story"),[j,L]=b.useState(!1),[R,k]=b.useState(""),[H,W]=b.useState(""),[P,V]=b.useState("");b.useEffect(()=>{const i="local-pizza-by-local-effort-let-s-make-1000-pizzas",l=`*[_type == "crowdfundingCampaign" && slug.current == $slug][0]{
      title,
      // Short description: prefer new field name, fallback to legacy if present
      "description": coalesce(description, shortDescription),
      // pizza-specific fields (keep legacy fields for backwards compatibility)
      pizzaGoal,
      pizzasSold,
      piesSold,
      goal,
      raisedAmount,
      backers,
      endDate,
      heroImage,
      story,
      goals,
      faq,
      "rewardTiers": rewardTiers[]->{ amount, pizzaCount, title, description, limit } | order(amount asc),
      "updates": updates[]->{ title, publishedAt, body } | order(publishedAt desc)
    }`,m={slug:i};(async()=>{try{const f=await Q.fetch(l,m);E(f)}catch(f){try{const h=f&&f.message?f.message:String(f);if(console.error("Sanity fetch error message:",h),f&&f.response&&typeof f.response.text=="function"){const g=await f.response.text();console.error("Sanity fetch response body:",g)}}catch(h){console.error("Error while logging Sanity error:",h)}try{const g=await Q.fetch(`*[_type == "crowdfundingCampaign"][0]{
            title,
            "description": coalesce(description, shortDescription),
            pizzaGoal,
            pizzasSold,
            piesSold,
            goal,
            raisedAmount,
            backers,
            endDate,
            heroImage,
            story,
            goals,
            faq,
            "rewardTiers": rewardTiers[]->{ amount, pizzaCount, title, description, limit } | order(amount asc),
            "updates": updates[]->{ title, publishedAt, body } | order(publishedAt desc)
          }`);if(g){console.warn("Loaded fallback campaign (first in dataset)"),E(g),O(null);return}}catch(h){console.error("Fallback fetch also failed:",h&&(h.message||h))}O("Failed to load campaign data.")}finally{x(!1)}})()},[]);const z=(s==null?void 0:s.rewardTiers)||[],I=b.useMemo(()=>z.find(i=>typeof(i==null?void 0:i.amount)=="number"&&i.amount>0)||null,[z]);if(b.useEffect(()=>{new URLSearchParams(window.location.search).get("payment")==="success"&&(async()=>{try{const l=localStorage.getItem("cf_items"),m=l?JSON.parse(l):[],p=localStorage.getItem("cf_name")||void 0;Array.isArray(m)&&m.length>0&&(await fetch("/api/crowdfund/confirm-payment",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({items:m,funderName:p})})).ok&&V("Thanks! Your contribution has been recorded.")}catch{}finally{try{localStorage.removeItem("cf_items"),localStorage.removeItem("cf_name")}catch{}}})()},[]),S)return n.createElement("div",{className:"text-center p-12"},"Loading campaign...");if(d){const i=typeof d=="string"?d:d&&(d.message||JSON.stringify(d))||"Failed to load campaign data.";return n.createElement("div",{className:"text-center p-12 text-red-600"},i)}if(!s)return n.createElement("div",{className:"text-center p-12"},"No campaign found. Have you created and published it in Sanity Studio?");const{title:M="Untitled Campaign",description:N=[],backers:G=0,endDate:q=null,heroImage:F=null}=s,J=s.piesSold??0,_=s.story||[],D=s.faq||[],$=async i=>{k(""),L(!0);try{try{localStorage.setItem("cf_items",JSON.stringify(i)),localStorage.setItem("cf_name",H||"")}catch{}const l=await fetch("/api/crowdfund/contribute",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({items:i})}),m=await l.json();if(!l.ok||!(m!=null&&m.url))throw new Error((m==null?void 0:m.error)||"Failed to create checkout");window.location.href=m.url}catch(l){k((l==null?void 0:l.message)||"Payment link failed")}finally{L(!1)}},A=s.updates||[],t=(s.pizzasSold??s.raisedAmount)||0,a=(s.pizzaGoal??s.goal)||1e3,r=q?Math.ceil((new Date(q)-new Date)/(1e3*60*60*24)):0,e=a>0?Math.min(t/a*100,100):0,c=({tabName:i,label:l})=>n.createElement("button",{type:"button",onClick:()=>B(i),"aria-pressed":v===i,className:`pb-2 px-1 text-lg font-semibold transition-colors ${v===i?"border-b-2 border-[var(--color-accent)] text-gray-900":"text-gray-500 hover:text-gray-800"}`},l);c.propTypes={tabName:y.string.isRequired,label:y.string.isRequired};const o=i=>i?typeof i=="string"?i:(i||[]).filter(Boolean).map(l=>typeof l=="string"?l:l.children&&Array.isArray(l.children)?l.children.map(m=>m.text||"").join(""):"").join(`
`).trim():"",u=i=>Array.isArray(i)?i:i?[{_type:"block",style:"normal",children:[{_type:"span",text:typeof i=="string"?i:String(i)}]}]:[];return n.createElement(n.Fragment,null,n.createElement(rt,null,n.createElement("title",null,`${M} | Crowdfunding Campaign`),n.createElement("meta",{name:"description",content:o(N).slice(0,160)})),n.createElement("div",{className:"space-y-16 mx-auto max-w-6xl px-4 md:px-6 lg:px-8"},n.createElement("div",null,n.createElement("h1",{className:"text-4xl md:text-6xl font-bold uppercase tracking-[-0.02em] leading-[1.02]"},M),n.createElement("div",{className:"mt-6 md:mt-8 text-body max-w-2xl"},N&&(Array.isArray(N)?n.createElement(C,{value:N}):n.createElement(C,{value:u(N)})))),n.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-5 lg:gap-16"},n.createElement("div",{className:"lg:col-span-3 space-y-8"},F&&n.createElement("img",{src:st(F).width(1200).quality(80).url(),alt:M,className:"w-full object-cover rounded-lg aspect-video bg-gray-100"}),n.createElement("div",{className:"border-b border-gray-200"},n.createElement("nav",{className:"flex space-x-8"},n.createElement(c,{tabName:"story",label:"Our Story"}),A.length>0&&n.createElement(c,{tabName:"updates",label:`Updates (${A.length})`}),n.createElement(c,{tabName:"goals",label:"Goals"}),D.length>0&&n.createElement(c,{tabName:"faq",label:"FAQ"}))),n.createElement("div",{className:"prose max-w-none text-body"},v==="story"&&_.length>0&&n.createElement(C,{value:_}),v==="updates"&&n.createElement("div",{className:"space-y-8"},A.map((i,l)=>n.createElement("div",{key:l,className:"p-4 border-l-4 border-gray-200"},n.createElement("h3",{className:"text-heading mt-0"},i.title),n.createElement("p",{className:"text-sm text-gray-500 mb-2"},new Date(i.publishedAt).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})),n.createElement(C,{value:i.body})))),v==="goals"&&n.createElement("div",{className:"space-y-6"},s.goals?Array.isArray(s.goals)?n.createElement(C,{value:s.goals}):n.createElement(C,{value:u(s.goals)}):n.createElement("p",{className:"text-gray-500"},"No goals content yet. Add content in the Goals field in Sanity Studio.")),v==="faq"&&n.createElement("div",{className:"space-y-6"},D.map((i,l)=>n.createElement("div",{key:l},n.createElement("h4",{className:"font-bold text-lg mb-1"},i.question),n.createElement("p",{className:"mt-0"},i.answer)))))),n.createElement("div",{className:"lg:col-span-2 space-y-8 mt-12 lg:mt-0"},n.createElement("div",{className:"card p-6 space-y-4"},n.createElement("div",{className:"w-full bg-gray-200 rounded-full h-2.5"},n.createElement("div",{className:"bg-[var(--color-accent)] h-2.5 rounded-full",style:{width:`${e}%`}})),n.createElement("div",null,n.createElement("p",{className:"text-4xl font-bold text-[var(--color-accent)]"},t.toLocaleString()," pizzas"),n.createElement("p",{className:"text-body text-gray-600"},"sold of ",a.toLocaleString()," pizzas goal"),n.createElement("p",{className:"mt-2 text-2xl font-semibold"},J.toLocaleString()," pies"),n.createElement("p",{className:"text-body text-gray-600"},"sold")),n.createElement("div",{className:"flex justify-between text-body text-center border-y py-3"},n.createElement(Y,{value:G.toLocaleString(),label:"backers"}),n.createElement(Y,{value:r>0?r:"Ended",label:r>0?"days to go":""})),P&&n.createElement("p",{className:"text-sm text-emerald-700"},P),R&&n.createElement("p",{className:"text-sm text-red-600"},R),n.createElement("div",{className:"flex flex-col gap-2"},n.createElement("label",{className:"text-sm",htmlFor:"cf-name"},"Your name (optional)"),n.createElement("input",{id:"cf-name",className:"input w-full",placeholder:"Name",value:H,onChange:i=>W(i.target.value)})),n.createElement("button",{disabled:!I,onClick:()=>I&&$([{name:I.title||"Pizza",price:I.amount,type:"pizza",pizzaCount:1}]),className:"btn btn-primary w-full text-lg py-3 disabled:opacity-60"},j?"Preparing checkout…":"Order a pizza")),n.createElement("div",{className:"space-y-4"},n.createElement("h3",{className:"text-heading uppercase"},"Support Us"),z.map(i=>n.createElement(X,{key:(i==null?void 0:i.title)||Math.random(),tier:i,busy:j,onContribute:l=>$([l])})))))))};export{ut as default};
