import{R as e,r as l,A as B,m as $,b as v,o as R,d as W,e as I,h,q as V,i as U,k as _,l as q,n as O,p as k,t as j,v as z,w as G,W as H}from"./index-B4cIQvsT.js";import{C as J}from"./cloudinaryImage-CJ6RoUlG.js";import{c as S}from"./sanityClient-CfKX1QDA.js";const F=()=>{const t={fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',fontSize:"10px"},a={mixBlendMode:"multiply"},n={fontSize:"10px",fontWeight:"bold",fill:"#000",textAnchor:"middle"},s={...n,fontSize:"8px",fill:"#FFFFFF"};return e.createElement("svg",{viewBox:"0 0 300 200",xmlns:"http://www.w3.org/2000/svg",style:t},e.createElement("circle",{cx:"115",cy:"120",r:"50",fill:"#fde047",style:a}),e.createElement("circle",{cx:"185",cy:"120",r:"50",fill:"#67e8f9",style:a}),e.createElement("circle",{cx:"150",cy:"70",r:"50",fill:"#fca5a5",style:a}),e.createElement("text",{x:"100",y:"130",style:n},"Cost Efficiency"),e.createElement("text",{x:"200",y:"130",style:n},"Local Ingredients"),e.createElement("text",{x:"150",y:"55",style:n},"Perfect Nutrition"),e.createElement("text",{x:"150",y:"105",style:s},"Foundation"),e.createElement("text",{x:"150",y:"115",style:s},"Meal Plan"))};function Y({items:t=[],intervalMs:a=5e3,className:n="",hideDots:s=!1,transitionStyle:o="fade"}){const[m,f]=l.useState(0),[x,i]=l.useState(1),p=l.useRef(null),E=()=>{i(1),f(u=>(u+1)%Math.max(t.length,1))},y=()=>{i(-1),f(u=>(u-1+Math.max(t.length,1))%Math.max(t.length,1))};if(l.useEffect(()=>t.length<=1?()=>{}:(p.current=setInterval(E,a),()=>clearInterval(p.current)),[t.length,a]),!t.length)return null;const b=t[m];return e.createElement("div",{className:`relative overflow-hidden ${n}`},e.createElement(B,{mode:"wait",custom:x},e.createElement($.div,{key:`${b.key}-${m}`,className:"w-full h-full",initial:o==="slide"?{x:x>0?"100%":"-100%",opacity:1}:{opacity:0},animate:o==="slide"?{x:0,opacity:1}:{opacity:1},exit:o==="slide"?{x:x>0?"-100%":"100%",opacity:1}:{opacity:0},transition:{duration:.5,ease:"easeInOut"},style:o==="slide"?{position:"absolute",inset:0}:void 0},b.node)),t.length>1&&!s&&e.createElement("div",{className:"absolute inset-x-0 bottom-3 flex justify-center gap-2"},t.map((u,g)=>e.createElement("button",{key:g,"aria-label":`Go to slide ${g+1}`,className:`w-2.5 h-2.5 rounded-full ${g===m?"bg-white":"bg-white/50"} border border-black/10`,onClick:()=>{i(g>m?1:-1),f(g)}}))),t.length>1&&e.createElement(e.Fragment,null,e.createElement("button",{"aria-label":"Previous slide",onClick:y,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/70 hover:bg-white text-black rounded-full w-8 h-8 flex items-center justify-center shadow"},"‹"),e.createElement("button",{"aria-label":"Next slide",onClick:E,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/70 hover:bg-white text-black rounded-full w-8 h-8 flex items-center justify-center shadow"},"›")))}function K(){const[t,a]=l.useState(null),[n,s]=l.useState(!0);return l.useEffect(()=>{if(!v)return s(!1),()=>{};const o=R(v,m=>{a(m||null),s(!1)});return()=>o()},[]),{user:t,loading:n}}function Q({user:t}){return e.createElement("div",{className:"flex items-center gap-3"},v?t?e.createElement(e.Fragment,null,e.createElement("span",{className:"text-sm text-gray-700"},"Hi, ",t.displayName||t.email),e.createElement("button",{onClick:W,className:"px-3 py-2 text-sm rounded border"},"Sign out")):e.createElement("button",{onClick:I,className:"px-3 py-2 text-sm rounded border"},"Sign in"):e.createElement("span",{className:"text-sm text-gray-600"},"Sign-in unavailable"))}function X({menus:t,onSelect:a}){return!t||t.length===0?e.createElement("p",{className:"text-gray-600"},"No menus yet."):e.createElement("ul",{className:"divide-y divide-gray-200 border rounded-md"},t.map(n=>e.createElement("li",{key:n._id,className:"p-4 flex items-center justify-between"},e.createElement("div",null,e.createElement("p",{className:"font-semibold"},n.clientName),e.createElement("p",{className:"text-sm text-gray-500"},"Week of ",n.date)),e.createElement("button",{type:"button",className:"px-3 py-1 rounded bg-gray-900 text-white text-sm",onClick:()=>a&&a(n)},"View"))))}function Z({menu:t,onBack:a}){var n;return t?e.createElement("div",{className:"space-y-4"},e.createElement("button",{onClick:a,className:"text-sm text-blue-600"},"← Back"),e.createElement("h4",{className:"text-2xl font-bold"},t.clientName),e.createElement("p",{className:"text-gray-600"},"Week of ",t.date),t.notes&&e.createElement("p",{className:"italic text-gray-700"},t.notes),e.createElement("ul",{className:"list-disc ml-6"},(n=t.menu)==null?void 0:n.map((s,o)=>e.createElement("li",{key:o},s)))):null}function ee({menuId:t,user:a}){const[n,s]=l.useState([]),[o,m]=l.useState(""),f=l.useRef(null);l.useEffect(()=>{if(!t||!h)return;const i=V(_(h,"mealprep_comments",t,"comments"),U("createdAt","desc")),p=q(i,E=>{s(E.docs.map(y=>({id:y.id,...y.data()})))});return()=>p()},[t]);const x=async i=>{var E;i.preventDefault();const p=o.trim();p&&h&&(await O(_(h,"mealprep_comments",t,"comments"),{body:p,createdAt:k(),uid:(a==null?void 0:a.uid)||null,name:(a==null?void 0:a.displayName)||"Anonymous"}),m(""),(E=f.current)==null||E.focus())};return e.createElement("div",{className:"mt-8 border-t pt-4"},e.createElement("h5",{className:"font-semibold mb-2"},"Comments"),a?e.createElement("form",{onSubmit:x,className:"flex gap-2 mb-4"},e.createElement("input",{ref:f,value:o,onChange:i=>m(i.target.value),className:"flex-1 border rounded px-3 py-2",placeholder:"Leave a comment"}),e.createElement("button",{className:"px-3 py-2 bg-gray-900 text-white rounded",type:"submit"},"Post")):e.createElement("p",{className:"text-sm text-gray-600"},"Sign in to comment."),e.createElement("ul",{className:"space-y-3"},n.map(i=>e.createElement("li",{key:i.id,className:"border rounded p-3"},e.createElement("p",{className:"text-sm text-gray-500"},i.name||"Anon"),e.createElement("p",null,i.body)))))}const te=[{key:"davidAllison",name:"David & Allison",clientName:"David and Allison",emails:[]},{key:"sanjay",name:"Sanjay",clientName:"Sanjay",emails:[]},{key:"shelley",name:"Shelley",clientName:"Shelley",emails:[]}];function ae(t){if(!t)return null;const a=(t.email||"").toLowerCase(),n=(t.displayName||"").toLowerCase();for(const s of te)for(const o of s.emails)if(a&&o&&a===String(o).toLowerCase())return s.clientName;return n.includes("sanjay")?"Sanjay":n.includes("shelley")?"Shelley":n.includes("david")||n.includes("allison")?"David and Allison":null}async function ne(t,a){if(!h||!t)return null;const n=j(h,"userProfiles",t),s={uid:t,...a,updatedAt:k?k():new Date};return await G(n,s,{merge:!0}),s}async function le(t){if(!h||!t)return null;const a=j(h,"userProfiles",t),n=await z(a);return n.exists()?n.data():null}const oe=()=>{const{user:t}=K(),[a,n]=l.useState([]),[s,o]=l.useState(!1),[m,f]=l.useState(null),[x,i]=l.useState(null),[p,E]=l.useState(""),[y,b]=l.useState(null),[u,g]=l.useState(null),[C,L]=l.useState([]);l.useEffect(()=>{let r=!1;return(async()=>{try{const c=await fetch("/api/search-images?query=mealplan&per_page=12");if(!c.ok)throw new Error(`Gallery fetch failed: ${c.status}`);const d=await c.json();if(r)return;const P=(d.images||[]).slice(0,12),A=[];for(let N=0;N<P.length;N+=3){const M=P.slice(N,N+3);A.push({key:M.map(w=>w.public_id).join("|")||`${N}`,node:e.createElement("div",{className:"grid grid-cols-3 gap-3"},M.map((w,T)=>e.createElement(J,{key:w.public_id||T,publicId:w.public_id,alt:w.public_id,className:"w-full aspect-square object-cover rounded transition-transform duration-300 hover:scale-[1.03]",placeholderMode:"none",sizes:"(min-width: 1024px) 33vw, (min-width: 640px) 50vw, 100vw"})))})}L(A)}catch{}})(),()=>{r=!0}},[]),l.useEffect(()=>{let r=!0;return(async()=>{if(!t){b(null);return}let c=null;try{const d=await le(t.uid);c=(d==null?void 0:d.mealPrepClientName)||null}catch{}if(c||(c=ae(t)),c)try{await ne(t.uid,{mealPrepClientName:c,email:t.email||null,displayName:t.displayName||null})}catch{}r&&b(c)})(),()=>{r=!1}},[t]),l.useEffect(()=>{let r=!0;return t?((async()=>{try{if(o(!0),f(null),!S||!S.fetch)throw new Error("Content service unavailable");const c=await S.fetch(`*[_type == "mealPrepMenu" && published == true] | order(date desc)[0...50]{
            _id, date, clientName, menu, notes
          }`);r&&n(c||[])}catch(c){r&&f(c.message||String(c))}finally{r&&o(!1)}})(),()=>{r=!1}):(n([]),o(!1),f(null),()=>{r=!1})},[t]);const D=l.useMemo(()=>{const r=y?a.filter(d=>(d.clientName||"").toLowerCase()===y.toLowerCase()):a,c=p.trim().toLowerCase();return c?r.filter(d=>(d.clientName||"").toLowerCase().includes(c)):r},[a,p,y]);return e.createElement(e.Fragment,null,e.createElement(H,null,e.createElement("title",null,"Weekly Meal Prep | Local Effort"),e.createElement("meta",{name:"description",content:"Our Foundation Meal Plan provides 21 nutritious meals per week from local Midwest sources."})),e.createElement("div",{className:"space-y-10"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("h2",{className:"text-5xl md:text-7xl font-bold uppercase"},"Weekly Meal Prep"),v?e.createElement(Q,{user:t}):null),e.createElement("p",{className:"font-mono text-lg max-w-3xl"},"Basic, good nutrition from local Midwest sources. We offer a Foundation Plan and are happy to create custom plans for any diet."),e.createElement("div",{className:"flex gap-4 items-center"},t?e.createElement("div",{className:"text-sm text-gray-700"},e.createElement("a",{href:"#menus",className:"underline"},"View current menus"),y?e.createElement("span",{className:"ml-2"},"for ",e.createElement("strong",null,y)):e.createElement("span",{className:"ml-2 italic"},"no client assigned yet")):e.createElement("button",{type:"button",className:"underline",onClick:async()=>{try{await I()}catch(r){alert(`Sign-in unavailable: ${(r==null?void 0:r.message)||r}`)}}},"Already a member? Sign in"),!v&&!t&&e.createElement("p",{className:"text-xs text-gray-500 ml-3"},"Sign-in unavailable. Check Firebase env in .env (VITE_FIREBASE_*) and allowed domains.")),C.length>0&&e.createElement("div",{className:"mt-4 min-h-[14rem] md:min-h-[18rem] lg:min-h-[22rem]"},e.createElement(Y,{items:C,intervalMs:7e3,className:"w-full",hideDots:!0,transitionStyle:"slide"})),e.createElement("div",{className:"grid md:grid-cols-2 gap-6"},e.createElement("div",{className:"border border-gray-900 rounded-md overflow-hidden"},e.createElement("button",{type:"button",className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100",onClick:()=>g(u==="foundation"?null:"foundation")},e.createElement("span",{className:"text-xl font-bold"},"Foundation Meal Plan"),e.createElement("span",{className:"text-sm text-gray-600"},u==="foundation"?"Hide ▲":"View More ▼")),e.createElement("div",{className:`transition-[max-height,opacity] duration-300 ease-in-out ${u==="foundation"?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden`},e.createElement("div",{className:"p-6"},e.createElement(F,null),e.createElement("p",{className:"font-mono mt-6 max-w-2xl"},"Inspired by the 'Protocol' by Bryan Johnson, this plan provides up to 21 meals/week at ~1800 calories/day.")))),e.createElement("div",{className:"border border-gray-900 rounded-md overflow-hidden"},e.createElement("button",{type:"button",className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100",onClick:()=>g(u==="custom"?null:"custom")},e.createElement("span",{className:"text-xl font-bold"},"Custom Plan"),e.createElement("span",{className:"text-sm text-gray-600"},u==="custom"?"Hide ▲":"View More ▼")),e.createElement("div",{className:`transition-[max-height,opacity] duration-300 ease-in-out ${u==="custom"?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden`},e.createElement("div",{className:"p-6"},e.createElement(F,null),e.createElement("p",{className:"font-mono mt-6 max-w-2xl"},"We tailor plans to your needs (gluten-free, vegetarian, high-protein, etc.). Tell us your goals and preferences and we’ll propose a weekly plan and schedule."))))),t&&e.createElement("section",{id:"menus",className:"space-y-4"},e.createElement("h3",{className:"text-2xl font-bold"},"Current Menus"),s?e.createElement("p",null,"Loading menus…"):m?e.createElement("div",{className:"text-red-700 bg-red-50 border border-red-200 p-3 rounded"},e.createElement("p",{className:"font-semibold"},m),e.createElement("p",{className:"text-sm mt-1"},"If this persists, ensure Sanity env vars are set on the web app (VITE_APP_SANITY_PROJECT_ID, VITE_APP_SANITY_DATASET) and that the Studio has the new Meal Prep Menu content.")):x?e.createElement("div",null,e.createElement(Z,{menu:x,onBack:()=>i(null)}),e.createElement(ee,{menuId:x._id,user:t})):e.createElement(X,{menus:D,onSelect:i}))))};export{oe as MealPrepPage,oe as default};
