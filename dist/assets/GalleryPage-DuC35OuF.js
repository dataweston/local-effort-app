import{r as l,R as e,W as T,m as f,A as j}from"./index-BNYhxoav.js";import{C as v}from"./cloudinaryImage-pZy3wa8E.js";const z=()=>{var b,x;const[r,N]=l.useState([]),[u,k]=l.useState(""),[C,p]=l.useState(!0),[h,E]=l.useState(null),[n,i]=l.useState(null),g=l.useRef(null);l.useEffect(()=>{let t=null;const s=setTimeout(async()=>{p(!0),E(null);try{t=new AbortController;const{signal:a}=t,c=u?`tags:${u}`:"",o=`/api/search-images?query=${encodeURIComponent(c)}`,m=await fetch(o,{signal:a}),w=m.headers.get("content-type");if(!w||!w.includes("application/json")){const I=await m.text();throw console.error("Non-JSON response (truncated):",I.substring(0,200)),new Error("API endpoint not found - got HTML instead of JSON")}if(!m.ok)throw new Error(`HTTP error! status: ${m.status}`);const _=await m.json();N(_.images||[])}catch(a){if(a.name==="AbortError")return;console.error("Error fetching images:",a),E(a.message||String(a))}finally{p(!1)}},500);return()=>{clearTimeout(s),t&&t.abort()}},[u]);const y=24,[A,L]=l.useState(y);l.useEffect(()=>L(y),[r]);const S=l.useCallback((t,s)=>{if(i({img:t,idx:s}),t&&t.large_url){const o=new Image;o.src=t.large_url}const a=(s+1)%r.length,c=r[a];if(c&&c.large_url){const o=new Image;o.src=c.large_url}},[i,r]),d=l.useCallback(()=>i(null),[i]);return l.useEffect(()=>{const t=s=>{if(n){if(s.key==="Escape"&&d(),s.key==="ArrowRight"){const a=(n.idx+1)%r.length;i({img:r[a],idx:a})}if(s.key==="ArrowLeft"){const a=(n.idx-1+r.length)%r.length;i({img:r[a],idx:a})}}};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[n,r,d]),l.useEffect(()=>{n&&g.current&&g.current.focus()},[n]),e.createElement(e.Fragment,null,e.createElement(T,null,e.createElement("title",null,"Pictures of Food | Local Effort")),e.createElement("div",{className:"container mx-auto px-4 py-8"},e.createElement("h1",{className:"text-4xl font-bold mb-4 text-center"},"Image Gallery"),e.createElement("input",{type:"text",value:u,onChange:t=>k(t.target.value),placeholder:"Search by tag (e.g., pizza, events)...",className:"w-full max-w-md mx-auto block p-3 border rounded-md mb-8"}),C?e.createElement("p",null,"Loading..."):h?e.createElement("div",{className:"text-red-600 bg-red-50 p-4 rounded"},e.createElement("h3",{className:"font-bold"},"Error Details:"),e.createElement("p",null,h),e.createElement("p",{className:"mt-2 text-sm"},"This usually means:"),e.createElement("ul",{className:"list-disc ml-6 text-sm"},e.createElement("li",null,"The /api/search-images.js file wasn't created properly"),e.createElement("li",null,"Environment variables aren't set in Vercel"),e.createElement("li",null,"The serverless function has an error")),e.createElement("p",{className:"mt-2 text-sm"},"Check the browser Network tab and Vercel function logs.")):r.length===0?e.createElement("div",{className:"text-center p-8"},e.createElement("p",null,"No images found."),e.createElement("p",{className:"text-sm text-gray-600 mt-2"},"Try removing search terms or check that you have images in your Cloudinary account.")):e.createElement("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},r.map((t,s)=>{var a,c,o;return e.createElement(f.button,{type:"button",key:t.asset_id,onClick:()=>S(t,s),whileHover:{scale:1.03},whileTap:{scale:.98},className:"border p-2 bg-white rounded-lg overflow-hidden","aria-label":((a=t.context)==null?void 0:a.alt)||`Gallery image ${s+1}`},t.thumbnail_url?e.createElement("img",{src:t.thumbnail_url,alt:((c=t.context)==null?void 0:c.alt)||"Gallery image",className:"rounded-lg object-cover w-full h-full aspect-square",loading:"lazy"}):e.createElement(v,{publicId:t.public_id,alt:((o=t.context)==null?void 0:o.alt)||"Gallery image",width:600,height:600,className:"rounded-lg object-cover w-full h-full aspect-square"}))}))),e.createElement(j,null,n&&e.createElement(f.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d},e.createElement(f.div,{className:"max-w-5xl w-full max-h-full",initial:{y:20,scale:.98},animate:{y:0,scale:1},exit:{y:20,scale:.98},onClick:t=>t.stopPropagation()},e.createElement("div",{className:"relative overflow-hidden"},e.createElement("button",{ref:g,className:"absolute right-2 top-2 z-10 bg-black/60 text-white rounded-full p-2",onClick:d,"aria-label":"Close image"},"âœ•"),e.createElement("div",{className:"flex items-center justify-center p-2"},n.img.large_url?e.createElement("img",{src:n.img.large_url,alt:((b=n.img.context)==null?void 0:b.alt)||"Large gallery image",className:"w-full h-auto max-h-[90vh] object-contain"}):e.createElement(v,{publicId:n.img.public_id,alt:((x=n.img.context)==null?void 0:x.alt)||"Large gallery image",width:1400,height:1e3,disableLazy:!0,className:"w-full h-auto max-h-[90vh] object-contain"})))))))};export{z as default};
