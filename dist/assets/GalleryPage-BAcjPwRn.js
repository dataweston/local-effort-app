import{r as l,R as t,W as q,m as C,A as B}from"./index-CUxUiH5k.js";import{C as z}from"./cloudinaryImage-BeHq9I20.js";const V=()=>{var j,P;const[s,_]=l.useState([]),[S,L]=l.useState(null),[p,G]=l.useState(""),[y,w]=l.useState(!0),[A,f]=l.useState(null),[o,h]=l.useState(null),I=l.useRef(!1),R=l.useRef(new Set),$=l.useCallback(async()=>I.current?null:new Promise(e=>{const n=typeof window<"u"&&window.photoData,a=()=>{const i=window&&window.photoData||[];if(Array.isArray(i)&&i.length){const N=i.map((u,c)=>({asset_id:u.src||String(c),public_id:u.src||String(c),context:{alt:u.title||"Gallery image"},thumbnail_url:u.src,large_url:u.src}));I.current=!0,e(N)}else e(null)};if(n)return a();const r=document.createElement("script");r.src="/gallery/photos.js",r.async=!0,r.onload=a,r.onerror=()=>e(null),document.body.appendChild(r)}),[]),x=l.useRef(null),D=36,k=l.useCallback(e=>{const n=e.slice();for(let a=n.length-1;a>0;a-=1){const r=Math.floor(Math.random()*(a+1));[n[a],n[r]]=[n[r],n[a]]}return n},[]),v=l.useCallback(async(e={})=>{const{append:n=!1,cursor:a=null,signal:r}=e,i=p?`query=${encodeURIComponent(p)}&`:"",N=a?`next_cursor=${encodeURIComponent(a)}&`:"",u=`/api/search-images?${i}${N}per_page=${D}`;try{const c=await fetch(u,{signal:r});if(!(c.headers.get("content-type")||"").includes("application/json")){const m=await c.text().catch(()=>""),U=m&&m.includes("<!DOCTYPE")?"API endpoint not found - got HTML instead of JSON":m||"Unexpected non-JSON response";throw new Error(U)}const d=await c.json();if(!c.ok){const m=d&&(d.error||d.details||JSON.stringify(d));throw new Error(`Search failed (${c.status}): ${m}`)}const M=Array.isArray(d.images)?d.images:[],O=k(M);_(m=>n?[...m,...O]:O),L(d.next_cursor||null)}catch(c){if(c.name==="AbortError")return;console.error("Error fetching images:",c);try{const g=await $();g&&g.length?(_(k(g)),f("Showing fallback images while the gallery API is unavailable.")):f(c.message||String(c))}catch{f(c.message||String(c))}}finally{w(!1)}},[p,k,$]),T=l.useCallback(()=>{if(typeof document>"u")return;const e="cld-preconnect";if(document.getElementById(e))return;const n=document.createElement("link");n.id=e,n.rel="preconnect",n.href="https://res.cloudinary.com",n.crossOrigin="",document.head.appendChild(n);const a=document.createElement("link");a.rel="dns-prefetch",a.href="https://res.cloudinary.com",document.head.appendChild(a)},[]),b=l.useCallback(e=>{if(!e||typeof document>"u"||R.current.has(e))return;try{const a=document.createElement("link");a.rel="preload",a.as="image",a.href=e,document.head.appendChild(a)}catch{}const n=new Image;n.decoding="async",n.src=e,R.current.add(e)},[]);l.useEffect(()=>{const e=new AbortController,n=setTimeout(()=>{w(!0),f(null),L(null),v({append:!1,cursor:null,signal:e.signal})},300);return()=>{clearTimeout(n),e.abort()}},[p,v]);const J=l.useCallback((e,n)=>{h({img:e,idx:n}),e&&e.large_url&&(T(),b(e.large_url));const a=(n+1)%s.length,r=s[a];r&&r.large_url&&b(r.large_url)},[h,s,b,T]),E=l.useCallback(()=>h(null),[h]);return l.useEffect(()=>{const e=n=>{if(o){if(n.key==="Escape"&&E(),n.key==="ArrowRight"){const a=(o.idx+1)%s.length;h({img:s[a],idx:a})}if(n.key==="ArrowLeft"){const a=(o.idx-1+s.length)%s.length;h({img:s[a],idx:a})}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,s,E]),l.useEffect(()=>{o&&x.current&&x.current.focus()},[o]),t.createElement(t.Fragment,null,t.createElement(q,null,t.createElement("title",null,"pictures of food. | Local Effort"),t.createElement("meta",{name:"description",content:"A visual gallery of dinners, events, meal prep, and plates from Local Effort."}),t.createElement("link",{rel:"preconnect",href:"https://res.cloudinary.com",crossOrigin:""}),t.createElement("link",{rel:"dns-prefetch",href:"https://res.cloudinary.com"}),t.createElement("script",{type:"application/ld+json"},JSON.stringify({"@context":"https://schema.org","@type":"Restaurant",name:"Local Effort",url:"https://local-effort-app.vercel.app/gallery",image:s.slice(0,8).map(e=>e.large_url||e.thumbnail_url).filter(Boolean),servesCuisine:["American","Local","Seasonal"],sameAs:[]}))),t.createElement("div",{className:"container mx-auto px-4 py-8"},t.createElement("h1",{className:"text-4xl font-bold mb-4 text-center"},"pictures of food."),t.createElement("input",{type:"text",value:p,onChange:e=>G(e.target.value),placeholder:"Search by tag (e.g., pizza, events, mealplan, plates, dinner, eggs)...",className:"w-full max-w-md mx-auto block p-3 border rounded-md mb-8"}),y?t.createElement("p",null,"Loading..."):A?t.createElement("div",{className:"text-red-600 bg-red-50 p-4 rounded"},t.createElement("h3",{className:"font-bold"},"Error Details:"),t.createElement("p",null,A),t.createElement("p",{className:"mt-2 text-sm"},"This usually means:"),t.createElement("ul",{className:"list-disc ml-6 text-sm"},t.createElement("li",null,"The /api/search-images.js file wasn't created properly"),t.createElement("li",null,"Environment variables aren't set in Vercel"),t.createElement("li",null,"The serverless function has an error")),t.createElement("p",{className:"mt-2 text-sm"},"Check the browser Network tab and Vercel function logs.")):s.length===0?t.createElement("div",{className:"text-center p-8"},t.createElement("p",null,"No images found."),t.createElement("p",{className:"text-sm text-gray-600 mt-2"},"Try removing search terms or check that you have images in your Cloudinary account.")):t.createElement(t.Fragment,null,t.createElement("div",{className:"columns-2 md:columns-3 lg:columns-4 gap-4 [column-fill:_balance]"},s.map((e,n)=>{var a,r,i;return t.createElement(C.button,{type:"button",key:e.asset_id,onClick:()=>J(e,n),onMouseEnter:()=>(e==null?void 0:e.large_url)&&b(e.large_url),whileHover:{scale:1.03},whileTap:{scale:.98},className:"mb-4 w-full break-inside-avoid border p-2 bg-white rounded-lg overflow-hidden","aria-label":((a=e.context)==null?void 0:a.alt)||`Gallery image ${n+1}`},e.thumbnail_url?t.createElement("img",{src:e.thumbnail_url,alt:((r=e.context)==null?void 0:r.alt)||"Gallery image",className:"rounded-lg w-full h-auto",width:e.width||void 0,height:e.height||void 0,style:e.width&&e.height?{aspectRatio:`${e.width} / ${e.height}`}:void 0,loading:"lazy"}):t.createElement(z,{publicId:e.public_id,alt:((i=e.context)==null?void 0:i.alt)||"Gallery image",width:800,className:"rounded-lg w-full h-auto",containerStyle:e.width&&e.height?{aspectRatio:`${e.width} / ${e.height}`}:void 0}))})),S&&t.createElement("div",{className:"mt-6 text-center"},t.createElement("button",{type:"button",onClick:()=>{y||(w(!0),f(null),v({append:!0,cursor:S}))},className:"px-4 py-2 rounded bg-black text-white hover:bg-neutral-800 disabled:opacity-50",disabled:y},y?"Loading…":"Load more")))),t.createElement(B,null,o&&t.createElement(C.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:E},t.createElement(C.div,{className:"max-w-5xl w-full max-h-full",initial:{y:20,scale:.98},animate:{y:0,scale:1},exit:{y:20,scale:.98},onClick:e=>e.stopPropagation()},t.createElement("div",{className:"relative overflow-hidden"},t.createElement("button",{ref:x,className:"absolute right-2 top-2 z-10 bg-black/60 text-white rounded-full p-2",onClick:E,"aria-label":"Close image"},"✕"),t.createElement("div",{className:"flex items-center justify-center p-2"},o.img.large_url?t.createElement("img",{src:o.img.large_url,alt:((j=o.img.context)==null?void 0:j.alt)||"Large gallery image",decoding:"async",fetchPriority:"high",className:"w-full h-auto max-h-[90vh] object-contain"}):t.createElement(z,{publicId:o.img.public_id,alt:((P=o.img.context)==null?void 0:P.alt)||"Large gallery image",width:1400,height:1e3,disableLazy:!0,eager:!0,className:"w-full h-auto max-h-[90vh] object-contain"})))))))};export{V as default};
