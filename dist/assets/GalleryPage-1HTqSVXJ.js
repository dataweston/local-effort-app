import{r,R as t,W as J,m as k,A as U}from"./index-D3iJpnhL.js";import{C as j}from"./cloudinaryImage-DCwoeDze.js";const M=()=>{var R,$;const[o,C]=r.useState([]),[_,S]=r.useState(null),[h,P]=r.useState(""),[y,w]=r.useState(!0),[L,g]=r.useState(null),[c,p]=r.useState(null),A=r.useRef(!1),I=r.useCallback(async()=>A.current?null:new Promise(e=>{const a=typeof window<"u"&&window.photoData,l=()=>{const i=window&&window.photoData||[];if(Array.isArray(i)&&i.length){const N=i.map((u,s)=>({asset_id:u.src||String(s),public_id:u.src||String(s),context:{alt:u.title||"Gallery image"},thumbnail_url:u.src,large_url:u.src}));A.current=!0,e(N)}else e(null)};if(a)return l();const n=document.createElement("script");n.src="/gallery/photos.js",n.async=!0,n.onload=l,n.onerror=()=>e(null),document.body.appendChild(n)}),[]),E=r.useRef(null),z=36,x=r.useCallback(e=>{const a=e.slice();for(let l=a.length-1;l>0;l-=1){const n=Math.floor(Math.random()*(l+1));[a[l],a[n]]=[a[n],a[l]]}return a},[]),v=r.useCallback(async(e={})=>{const{append:a=!1,cursor:l=null,signal:n}=e,i=h?`query=${encodeURIComponent(h)}&`:"",N=l?`next_cursor=${encodeURIComponent(l)}&`:"",u=`/api/search-images?${i}${N}per_page=${z}`;try{const s=await fetch(u,{signal:n});if(!(s.headers.get("content-type")||"").includes("application/json")){const d=await s.text().catch(()=>""),D=d&&d.includes("<!DOCTYPE")?"API endpoint not found - got HTML instead of JSON":d||"Unexpected non-JSON response";throw new Error(D)}const m=await s.json();if(!s.ok){const d=m&&(m.error||m.details||JSON.stringify(m));throw new Error(`Search failed (${s.status}): ${d}`)}const O=Array.isArray(m.images)?m.images:[],T=x(O);C(d=>a?[...d,...T]:T),S(m.next_cursor||null)}catch(s){if(s.name==="AbortError")return;console.error("Error fetching images:",s);try{const f=await I();f&&f.length?(C(x(f)),g("Showing fallback images while the gallery API is unavailable.")):g(s.message||String(s))}catch{g(s.message||String(s))}}finally{w(!1)}},[h,x,I]);r.useEffect(()=>{const e=new AbortController,a=setTimeout(()=>{w(!0),g(null),S(null),v({append:!1,cursor:null,signal:e.signal})},300);return()=>{clearTimeout(a),e.abort()}},[h,v]);const G=r.useCallback((e,a)=>{if(p({img:e,idx:a}),e&&e.large_url){const i=new Image;i.src=e.large_url}const l=(a+1)%o.length,n=o[l];if(n&&n.large_url){const i=new Image;i.src=n.large_url}},[p,o]),b=r.useCallback(()=>p(null),[p]);return r.useEffect(()=>{const e=a=>{if(c){if(a.key==="Escape"&&b(),a.key==="ArrowRight"){const l=(c.idx+1)%o.length;p({img:o[l],idx:l})}if(a.key==="ArrowLeft"){const l=(c.idx-1+o.length)%o.length;p({img:o[l],idx:l})}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[c,o,b]),r.useEffect(()=>{c&&E.current&&E.current.focus()},[c]),t.createElement(t.Fragment,null,t.createElement(J,null,t.createElement("title",null,"pictures of food. | Local Effort"),t.createElement("meta",{name:"description",content:"A visual gallery of dinners, events, meal prep, and plates from Local Effort."}),t.createElement("script",{type:"application/ld+json"},JSON.stringify({"@context":"https://schema.org","@type":"Restaurant",name:"Local Effort",url:"https://local-effort-app.vercel.app/gallery",image:o.slice(0,8).map(e=>e.large_url||e.thumbnail_url).filter(Boolean),servesCuisine:["American","Local","Seasonal"],sameAs:[]}))),t.createElement("div",{className:"container mx-auto px-4 py-8"},t.createElement("h1",{className:"text-4xl font-bold mb-4 text-center"},"pictures of food."),t.createElement("input",{type:"text",value:h,onChange:e=>P(e.target.value),placeholder:"Search by tag (e.g., pizza, events, mealplan, plates, dinner, eggs)...",className:"w-full max-w-md mx-auto block p-3 border rounded-md mb-8"}),y?t.createElement("p",null,"Loading..."):L?t.createElement("div",{className:"text-red-600 bg-red-50 p-4 rounded"},t.createElement("h3",{className:"font-bold"},"Error Details:"),t.createElement("p",null,L),t.createElement("p",{className:"mt-2 text-sm"},"This usually means:"),t.createElement("ul",{className:"list-disc ml-6 text-sm"},t.createElement("li",null,"The /api/search-images.js file wasn't created properly"),t.createElement("li",null,"Environment variables aren't set in Vercel"),t.createElement("li",null,"The serverless function has an error")),t.createElement("p",{className:"mt-2 text-sm"},"Check the browser Network tab and Vercel function logs.")):o.length===0?t.createElement("div",{className:"text-center p-8"},t.createElement("p",null,"No images found."),t.createElement("p",{className:"text-sm text-gray-600 mt-2"},"Try removing search terms or check that you have images in your Cloudinary account.")):t.createElement(t.Fragment,null,t.createElement("div",{className:"columns-2 md:columns-3 lg:columns-4 gap-4 [column-fill:_balance]"},o.map((e,a)=>{var l,n,i;return t.createElement(k.button,{type:"button",key:e.asset_id,onClick:()=>G(e,a),whileHover:{scale:1.03},whileTap:{scale:.98},className:"mb-4 w-full break-inside-avoid border p-2 bg-white rounded-lg overflow-hidden","aria-label":((l=e.context)==null?void 0:l.alt)||`Gallery image ${a+1}`},e.thumbnail_url?t.createElement("img",{src:e.thumbnail_url,alt:((n=e.context)==null?void 0:n.alt)||"Gallery image",className:"rounded-lg w-full h-auto",width:e.width||void 0,height:e.height||void 0,style:e.width&&e.height?{aspectRatio:`${e.width} / ${e.height}`}:void 0,loading:"lazy"}):t.createElement(j,{publicId:e.public_id,alt:((i=e.context)==null?void 0:i.alt)||"Gallery image",width:800,className:"rounded-lg w-full h-auto",containerStyle:e.width&&e.height?{aspectRatio:`${e.width} / ${e.height}`}:void 0}))})),_&&t.createElement("div",{className:"mt-6 text-center"},t.createElement("button",{type:"button",onClick:()=>{y||(w(!0),g(null),v({append:!0,cursor:_}))},className:"px-4 py-2 rounded bg-black text-white hover:bg-neutral-800 disabled:opacity-50",disabled:y},y?"Loading…":"Load more")))),t.createElement(U,null,c&&t.createElement(k.div,{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:b},t.createElement(k.div,{className:"max-w-5xl w-full max-h-full",initial:{y:20,scale:.98},animate:{y:0,scale:1},exit:{y:20,scale:.98},onClick:e=>e.stopPropagation()},t.createElement("div",{className:"relative overflow-hidden"},t.createElement("button",{ref:E,className:"absolute right-2 top-2 z-10 bg-black/60 text-white rounded-full p-2",onClick:b,"aria-label":"Close image"},"✕"),t.createElement("div",{className:"flex items-center justify-center p-2"},c.img.large_url?t.createElement("img",{src:c.img.large_url,alt:((R=c.img.context)==null?void 0:R.alt)||"Large gallery image",className:"w-full h-auto max-h-[90vh] object-contain"}):t.createElement(j,{publicId:c.img.public_id,alt:(($=c.img.context)==null?void 0:$.alt)||"Large gallery image",width:1400,height:1e3,disableLazy:!0,className:"w-full h-auto max-h-[90vh] object-contain"})))))))};export{M as default};
