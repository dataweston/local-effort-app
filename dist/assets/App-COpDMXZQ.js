import{r as u,K as A,k as p,R as e,N as L,O as B,q as M,l as O,o as V,I as G,p as I}from"./index-CkvQWwJC.js";import{D as Q,C as U,a as W,M as Y}from"./minus-CrmryO_k.js";import{S as H,D as j,T as K,a as J}from"./trash-2-BAzKoqJe.js";import{P as $}from"./plus-CkJLQbRp.js";import{F as X,S as Z,C as _,A as ee}from"./send-DJiGB_kj.js";const te=({items:g})=>{const[m,x]=u.useState(g.reduce((a,s)=>(a[s.id]={flour:0,meat:0,vegetables:0,dairy:0,otherToppings:0,packaging:0,label:0,custom:[]},a),{})),[o,f]=u.useState(!1),E=A(p,"costing","worksheet"),N=async()=>{f(!0);try{if(!p)return;const a=await L(E);if(a.exists()){const s=a.data(),r=g.reduce((c,l)=>(c[l.id]={...m[l.id],...s[l.id]||{}},c),{});x(r)}}catch(a){console.error("Error loading costs:",a),alert("Error loading costs. Please check the console for details.")}f(!1)};u.useEffect(()=>{N()},[]);const v=async()=>{f(!0);try{if(!p)return;await B(E,m),alert("Costs saved successfully!")}catch(a){console.error("Error saving costs:",a),alert("Error saving costs. Please try again.")}f(!1)},h=(a,s,r,c=null)=>{const l={...m};c!==null?l[a].custom[c][s]=r:l[a][s]=parseFloat(r)||0,x(l)},w=a=>{var r;const s={...m};(r=s[a])!=null&&r.custom||(s[a].custom=[]),s[a].custom.push({name:"",cost:0}),x(s)},k=(a,s)=>{const r={...m};r[a].custom.splice(s,1),x(r)},n=a=>{const s=m[a];if(!s)return 0;const r=(s.custom||[]).reduce((c,l)=>c+(parseFloat(l.cost)||0),0);return(s.flour||0)+(s.meat||0)+(s.vegetables||0)+(s.dairy||0)+(s.otherToppings||0)+(s.packaging||0)+(s.label||0)+r},C=a=>{const s=[{name:"packaging",label:"Packaging"},{name:"label",label:"Label"}];let r=[];return a.category==="Sandwiches"?r=[{name:"flour",label:"Flour"},{name:"meat",label:"Meat"},{name:"vegetables",label:"Vegetables"},{name:"dairy",label:"Dairy"},{name:"otherToppings",label:"Other Toppings"}]:a.category==="Pizza"&&(r=[{name:"flour",label:"Dough/Flour"},{name:"meat",label:"Meat"},{name:"vegetables",label:"Vegetables"},{name:"dairy",label:"Cheese/Dairy"},{name:"otherToppings",label:"Sauce & Toppings"}]),[...r,...s].map(l=>{var y;return e.createElement("div",{key:l.name,className:"flex items-center"},e.createElement("label",{className:"w-1/2 text-sm text-slate-600"},l.label),e.createElement("div",{className:"w-1/2 relative"},e.createElement(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e.createElement("input",{type:"number",step:"0.01",value:((y=m[a.id])==null?void 0:y[l.name])||"",onChange:S=>h(a.id,l.name,S.target.value),className:"w-full pl-8 pr-2 py-1 border border-slate-300 rounded-md",disabled:o})))})};return e.createElement("div",{className:"bg-white rounded-2xl shadow-xl p-6"},e.createElement("div",{className:"flex justify-between items-center mb-6"},e.createElement("h2",{className:"text-2xl font-bold text-slate-800"},"Costing Worksheet"),e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:N,disabled:o,className:"px-4 py-2 rounded-lg font-medium transition-all flex items-center justify-center gap-2 bg-slate-500 hover:bg-slate-600 text-white"},e.createElement(Q,{size:18}),o?"Loading...":"Reload Costs"),e.createElement("button",{onClick:v,disabled:o,className:"px-4 py-2 rounded-lg font-medium transition-all flex items-center justify-center gap-2 bg-blue-500 hover:bg-blue-600 text-white"},e.createElement(H,{size:18}),o?"Saving...":"Save Costs"))),e.createElement("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6"},g.map(a=>{var s;return e.createElement("div",{key:a.id,className:`p-4 border border-slate-200 rounded-xl ${o?"bg-slate-50 opacity-50":""}`},e.createElement("h3",{className:"font-semibold text-slate-800 text-lg mb-2"},a.name),e.createElement("div",{className:"space-y-2"},C(a),(((s=m[a.id])==null?void 0:s.custom)||[]).map((r,c)=>e.createElement("div",{key:c,className:"flex items-center space-x-2"},e.createElement("input",{type:"text",placeholder:"Custom Ingredient",value:r.name,onChange:l=>h(a.id,"name",l.target.value,c),className:"w-1/2 px-2 py-1 border border-slate-300 rounded-md",disabled:o}),e.createElement("div",{className:"w-1/2 relative flex items-center"},e.createElement(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:16}),e.createElement("input",{type:"number",step:"0.01",placeholder:"Cost",value:r.cost,onChange:l=>h(a.id,"cost",l.target.value,c),className:"w-full pl-8 pr-2 py-1 border border-slate-300 rounded-md",disabled:o}),e.createElement("button",{onClick:()=>k(a.id,c),className:"ml-2 text-red-500 hover:text-red-700",disabled:o},e.createElement(K,{size:16}))))),e.createElement("button",{onClick:()=>w(a.id),className:"text-sm text-blue-500 hover:text-blue-700 flex items-center gap-1",disabled:o},e.createElement($,{size:14})," Add Custom Ingredient")),e.createElement("div",{className:"border-t mt-4 pt-2 flex justify-between items-center"},e.createElement("span",{className:"font-semibold"},"Total Cost:"),e.createElement("span",{className:"font-bold text-blue-600"},"$",n(a.id).toFixed(2))))})))},oe=()=>{const[g]=u.useState([{id:1,name:"Egg Salad Sandwich",price:5.1,category:"Sandwiches"},{id:2,name:"Turkey Breast",price:6.1,category:"Sandwiches"},{id:3,name:"Roast Beef",price:7.1,category:"Sandwiches"},{id:4,name:"Pastrami",price:7.1,category:"Sandwiches"},{id:5,name:"Mortadella",price:7.1,category:"Sandwiches"},{id:6,name:"Vegetable",price:6.1,category:"Sandwiches"},{id:7,name:'12" Cheese',price:7.1,category:"Pizza"},{id:8,name:'4" Cheese',price:3.6,category:"Pizza"},{id:9,name:'12" Pepperoni',price:8.1,category:"Pizza"},{id:10,name:'12" Seasonal',price:8.1,category:"Pizza"},{id:11,name:'12" Gluten Free',price:8.1,category:"Pizza"},{id:12,name:"Beet Salad",price:5.1,category:"Salads"},{id:13,name:"Pasta Salad (gluten free)",price:3.1,category:"Salads"},{id:14,name:"Yogurt & Granola (gluten free)",price:3.1,category:"Breakfast"},{id:15,name:"Yogurt & Granola with chocolate (gluten free)",price:4.1,category:"Breakfast"},{id:16,name:"Chia Pudding",price:3.1,category:"Breakfast"},{id:17,name:"Chia Pudding (dairy free)",price:4.1,category:"Breakfast"}]),[m,x]=u.useState("order"),[o,f]=u.useState({}),[E,N]=u.useState(!1),[v,h]=u.useState(""),[w,k]=u.useState([]),[n,C]=u.useState(null),[a,s]=u.useState({orderId:null,reason:""}),[r,c]=u.useState(!1);u.useEffect(()=>{l()},[]);const l=async()=>{if(p)try{const t=M(O(p,"orders"),V("createdAt","desc")),d=await G(t),i=[];d.forEach(b=>{i.push({id:b.id,firestoreId:b.id,...b.data()})}),k(i)}catch(t){console.error("Error loading orders:",t)}},y=()=>Object.entries(o).reduce((t,[d,i])=>{const b=g.find(D=>D.id===parseInt(d));return t+(b?b.price*i:0)},0),S=(t,d)=>{f(i=>{const b={...i},D=b[t]||0,F=Math.max(0,D+d);return F===0?delete b[t]:b[t]=F,b})},R=async()=>{if(!(!E||Object.keys(o).length===0||r||!p)){c(!0);try{const t={date:new Date().toISOString().split("T")[0],items:{...o},total:y(),notes:v,status:"unpaid",createdAt:new Date,orderNumber:`ORD-${Date.now()}`};await I(O(p,"orders"),t),f({}),N(!1),h(""),await l(),alert("Order submitted successfully!")}catch(t){console.error("Error submitting order:",t),alert("Error submitting order. Please try again.")}c(!1)}},T=async()=>{if(!(!a.orderId||!a.reason.trim()||r||!p)){c(!0);try{await I(O(p,"refundRequests"),{orderId:a.orderId,reason:a.reason,createdAt:new Date,status:"pending"}),alert(`Refund request submitted for order ${n.orderNumber||n.id}`),s({orderId:null,reason:""})}catch(t){console.error("Error submitting refund request:",t),alert("Error submitting refund request. Please try again.")}c(!1)}},P=t=>g.find(d=>d.id===t),q=y(),z=Object.keys(o).length>0;return e.createElement("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50"},e.createElement("div",{className:"container mx-auto px-4 py-8 max-w-4xl"},e.createElement("div",{className:"text-center mb-8"},e.createElement("h1",{className:"text-4xl font-bold text-slate-800 mb-2"},"Local Effort â†” Happy Monday"),e.createElement("p",{className:"text-slate-600"},"Trade Order System")),e.createElement("div",{className:"flex justify-center mb-8"},e.createElement("div",{className:"bg-white rounded-xl p-1 shadow-lg"},e.createElement("button",{onClick:()=>x("order"),className:`px-6 py-3 rounded-lg font-medium transition-all flex items-center gap-2 ${m==="order"?"bg-blue-500 text-white shadow-md":"text-slate-600 hover:text-blue-500"}`},e.createElement(J,{size:20})," New Order"),e.createElement("button",{onClick:()=>x("invoices"),className:`px-6 py-3 rounded-lg font-medium transition-all flex items-center gap-2 ${m==="invoices"?"bg-blue-500 text-white shadow-md":"text-slate-600 hover:text-blue-500"}`},e.createElement(X,{size:20})," Past Orders"),e.createElement("button",{onClick:()=>x("costing"),className:`px-6 py-3 rounded-lg font-medium transition-all flex items-center gap-2 ${m==="costing"?"bg-blue-500 text-white shadow-md":"text-slate-600 hover:text-blue-500"}`},e.createElement(U,{size:20})," Costing"))),m==="order"&&e.createElement("div",{className:"grid lg:grid-cols-3 gap-8"},e.createElement("div",{className:"lg:col-span-2"},e.createElement("div",{className:"bg-white rounded-2xl shadow-xl p-6"},e.createElement("h2",{className:"text-2xl font-bold text-slate-800 mb-6"},"Available Items"),e.createElement("div",{className:"grid gap-4"},g.map(t=>e.createElement("div",{key:t.id,className:"flex items-center justify-between p-4 border border-slate-200 rounded-xl hover:border-blue-300 transition-colors"},e.createElement("div",{className:"flex-1"},e.createElement("h3",{className:"font-semibold text-slate-800"},t.name),e.createElement("p",{className:"text-sm text-slate-500"},t.category),e.createElement("p",{className:"text-lg font-bold text-blue-600"},"$",t.price.toFixed(2))),e.createElement("div",{className:"flex items-center gap-3"},e.createElement("button",{onClick:()=>S(t.id,-1),className:"w-8 h-8 rounded-full bg-slate-200 hover:bg-slate-300 flex items-center justify-center transition-colors",disabled:!o[t.id]},e.createElement(W,{size:16})),e.createElement("span",{className:"w-8 text-center font-medium"},o[t.id]||0),e.createElement("button",{onClick:()=>S(t.id,1),className:"w-8 h-8 rounded-full bg-blue-500 hover:bg-blue-600 text-white flex items-center justify-center transition-colors"},e.createElement($,{size:16})))))))),e.createElement("div",{className:"lg:col-span-1"},e.createElement("div",{className:"bg-white rounded-2xl shadow-xl p-6 sticky top-8"},e.createElement("h2",{className:"text-2xl font-bold text-slate-800 mb-6"},"Order Summary"),e.createElement("div",{className:"mb-4 p-3 bg-slate-50 rounded-lg"},e.createElement("p",{className:"text-sm text-slate-600"},"Order Date"),e.createElement("p",{className:"font-medium"},new Date().toLocaleDateString())),z?e.createElement("div",{className:"space-y-2 mb-4"},Object.entries(o).map(([t,d])=>{const i=P(parseInt(t));return e.createElement("div",{key:t,className:"flex justify-between text-sm"},e.createElement("span",null,i.name," Ã— ",d),e.createElement("span",null,"$",(i.price*d).toFixed(2)))})):e.createElement("p",{className:"text-slate-500 text-center py-4"},"No items selected"),e.createElement("div",{className:"border-t pt-4 mb-6"},e.createElement("div",{className:"flex justify-between text-xl font-bold"},e.createElement("span",null,"Total:"),e.createElement("span",{className:"text-blue-600"},"$",q.toFixed(2)))),e.createElement("div",{className:"mb-6"},e.createElement("label",{htmlFor:"hm-special-instructions",className:"block text-sm font-medium text-slate-700 mb-2"},"Special Instructions"),e.createElement("textarea",{id:"hm-special-instructions",value:v,onChange:t=>h(t.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:"3",placeholder:"Any special requests or notes..."})),e.createElement("div",{className:"mb-6"},e.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},e.createElement("input",{type:"checkbox",checked:E,onChange:t=>N(t.target.checked),className:"w-4 h-4 text-blue-500 border-slate-300 rounded focus:ring-blue-500"}),e.createElement("span",{className:"text-sm text-slate-700"},"I confirm this order is correct"))),e.createElement("button",{onClick:R,disabled:!E||!z||r,className:`w-full py-3 rounded-xl font-medium transition-all flex items-center justify-center gap-2 ${E&&z&&!r?"bg-blue-500 hover:bg-blue-600 text-white shadow-lg hover:shadow-xl":"bg-slate-200 text-slate-400 cursor-not-allowed"}`},e.createElement(Z,{size:20}),r?"Submitting...":"Submit Order")))),m==="invoices"&&!n&&e.createElement("div",{className:"bg-white rounded-2xl shadow-xl p-6"},e.createElement("h2",{className:"text-2xl font-bold text-slate-800 mb-6"},"Past Orders"),w.length===0?e.createElement("p",{className:"text-slate-500 text-center py-8"},"No orders yet"):e.createElement("div",{className:"space-y-4"},w.map(t=>e.createElement("div",{key:t.id,onClick:()=>C(t),className:"p-4 border border-slate-200 rounded-xl hover:border-blue-300 cursor-pointer transition-all hover:shadow-md"},e.createElement("div",{className:"flex justify-between items-start"},e.createElement("div",null,e.createElement("h3",{className:"font-semibold text-slate-800"},t.orderNumber||t.id),e.createElement("p",{className:"text-sm text-slate-500 flex items-center gap-1"},e.createElement(_,{size:14}),new Date(t.date).toLocaleDateString()),t.notes&&e.createElement("p",{className:"text-sm text-slate-600 mt-1 flex items-center gap-1"},e.createElement(Y,{size:14}),t.notes)),e.createElement("div",{className:"text-right"},e.createElement("p",{className:"text-lg font-bold text-blue-600"},"$",t.total.toFixed(2)),e.createElement("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${t.status==="paid"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"}`},t.status.toUpperCase()))))))),m==="invoices"&&n&&e.createElement("div",{className:"bg-white rounded-2xl shadow-xl p-6"},e.createElement("div",{className:"flex items-center gap-4 mb-6"},e.createElement("button",{onClick:()=>C(null),className:"p-2 hover:bg-slate-100 rounded-lg transition-colors"},e.createElement(ee,{size:20})),e.createElement("h2",{className:"text-2xl font-bold text-slate-800"},"Invoice ",n.orderNumber||n.id)),e.createElement("div",{className:"grid md:grid-cols-2 gap-6 mb-6"},e.createElement("div",null,e.createElement("h3",{className:"font-semibold text-slate-800 mb-2"},"Order Details"),e.createElement("p",{className:"text-sm text-slate-600"},"Date: ",new Date(n.date).toLocaleDateString()),e.createElement("p",{className:"text-sm text-slate-600"},"Status: ",e.createElement("span",{className:`font-medium ${n.status==="paid"?"text-green-600":"text-orange-600"}`},n.status.toUpperCase())),n.notes&&e.createElement("div",{className:"mt-2"},e.createElement("p",{className:"text-sm text-slate-600"},"Notes:"),e.createElement("p",{className:"text-sm text-slate-800"},n.notes))),e.createElement("div",{className:"text-right"},e.createElement("h3",{className:"font-semibold text-slate-800 mb-2"},"Total Amount"),e.createElement("p",{className:"text-3xl font-bold text-blue-600"},"$",n.total.toFixed(2)))),e.createElement("div",{className:"mb-6"},e.createElement("h3",{className:"font-semibold text-slate-800 mb-4"},"Items Ordered"),e.createElement("div",{className:"space-y-2"},Object.entries(n.items).map(([t,d])=>{const i=P(parseInt(t));return e.createElement("div",{key:t,className:"flex justify-between p-3 bg-slate-50 rounded-lg"},e.createElement("div",null,e.createElement("p",{className:"font-medium"},i?i.name:`Item ${t}`),e.createElement("p",{className:"text-sm text-slate-600"},"Quantity: ",d)),e.createElement("p",{className:"font-medium"},"$",i?(i.price*d).toFixed(2):"0.00"))}))),e.createElement("div",{className:"border-t pt-6"},e.createElement("h3",{className:"font-semibold text-slate-800 mb-4"},"Request Refund or Credit"),e.createElement("textarea",{value:a.orderId===n.id?a.reason:"",onChange:t=>s({orderId:n.id,reason:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none mb-4",rows:"3",placeholder:"Please explain the reason for your refund or credit request..."}),e.createElement("button",{onClick:T,disabled:!a.reason.trim()||a.orderId!==n.id||r,className:`px-6 py-2 rounded-lg font-medium transition-all ${a.reason.trim()&&a.orderId===n.id&&!r?"bg-orange-500 hover:bg-orange-600 text-white":"bg-slate-200 text-slate-400 cursor-not-allowed"}`},r?"Submitting...":"Submit Refund Request"))),m==="costing"&&e.createElement(te,{items:g})))};export{oe as default};
