import{R as e,e as w,h as P,i as S,r,k as g,q as k,o as M,l as h,n as A,p as F,t as _,v as L,w as T,d as N,W as j}from"./index-C77HZ0tF.js";import{P as B}from"./PhotoGrid-Cn-ZJxgQ.js";import{u as D}from"./useAuthUser-D56VcM0P.js";import"./cloudinaryImage-CjdiiyR1.js";const v=()=>{const t={fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',fontSize:"10px"},a={mixBlendMode:"multiply"},n={fontSize:"10px",fontWeight:"bold",fill:"#000",textAnchor:"middle"},o={...n,fontSize:"8px",fill:"#FFFFFF"};return e.createElement("svg",{viewBox:"0 0 300 200",xmlns:"http://www.w3.org/2000/svg",style:t},e.createElement("circle",{cx:"115",cy:"120",r:"50",fill:"#fde047",style:a}),e.createElement("circle",{cx:"185",cy:"120",r:"50",fill:"#67e8f9",style:a}),e.createElement("circle",{cx:"150",cy:"70",r:"50",fill:"#fca5a5",style:a}),e.createElement("text",{x:"100",y:"130",style:n},"Cost Efficiency"),e.createElement("text",{x:"200",y:"130",style:n},"Local Ingredients"),e.createElement("text",{x:"150",y:"55",style:n},"Perfect Nutrition"),e.createElement("text",{x:"150",y:"105",style:o},"Foundation"),e.createElement("text",{x:"150",y:"115",style:o},"Meal Plan"))};function W({user:t}){return e.createElement("div",{className:"flex items-center gap-3"},w?t?e.createElement(e.Fragment,null,e.createElement("span",{className:"text-sm text-gray-700"},"Hi, ",t.displayName||t.email),e.createElement("button",{onClick:P,className:"px-3 py-2 text-sm rounded border"},"Sign out")):e.createElement("button",{onClick:S,className:"px-3 py-2 text-sm rounded border"},"Sign in"):e.createElement("span",{className:"text-sm text-gray-600"},"Sign-in unavailable"))}function I({menus:t,onSelect:a}){return!t||t.length===0?e.createElement("p",{className:"text-gray-600"},"No menus yet."):e.createElement("ul",{className:"divide-y divide-gray-200 border rounded-md"},t.map(n=>e.createElement("li",{key:n._id,className:"p-4 flex items-center justify-between"},e.createElement("div",null,e.createElement("p",{className:"font-semibold"},n.clientName),e.createElement("p",{className:"text-sm text-gray-500"},"Week of ",n.date)),e.createElement("button",{type:"button",className:"px-3 py-1 rounded bg-gray-900 text-white text-sm",onClick:()=>a&&a(n)},"View"))))}function V({menu:t,onBack:a}){var n;return t?e.createElement("div",{className:"space-y-4"},e.createElement("button",{onClick:a,className:"text-sm text-blue-600"},"← Back"),e.createElement("h4",{className:"text-2xl font-bold"},t.clientName),e.createElement("p",{className:"text-gray-600"},"Week of ",t.date),t.notes&&e.createElement("p",{className:"italic text-gray-700"},t.notes),e.createElement("ul",{className:"list-disc ml-6"},(n=t.menu)==null?void 0:n.map((o,m)=>e.createElement("li",{key:m},o)))):null}function R({menuId:t,user:a}){const[n,o]=r.useState([]),[m,y]=r.useState(""),p=r.useRef(null);r.useEffect(()=>{if(!t||!g)return;const c=k(h(g,"mealprep_comments",t,"comments"),M("createdAt","desc")),d=A(c,i=>{o(i.docs.map(E=>({id:E.id,...E.data()})))});return()=>d()},[t]);const x=async c=>{var i;c.preventDefault();const d=m.trim();d&&g&&(await F(h(g,"mealprep_comments",t,"comments"),{body:d,createdAt:_(),uid:(a==null?void 0:a.uid)||null,name:(a==null?void 0:a.displayName)||"Anonymous"}),y(""),(i=p.current)==null||i.focus())};return e.createElement("div",{className:"mt-8 border-t pt-4"},e.createElement("h5",{className:"font-semibold mb-2"},"Comments"),a?e.createElement("form",{onSubmit:x,className:"flex gap-2 mb-4"},e.createElement("input",{ref:p,value:m,onChange:c=>y(c.target.value),className:"flex-1 border rounded px-3 py-2",placeholder:"Leave a comment"}),e.createElement("button",{className:"px-3 py-2 bg-gray-900 text-white rounded",type:"submit"},"Post")):e.createElement("p",{className:"text-sm text-gray-600"},"Sign in to comment."),e.createElement("ul",{className:"space-y-3"},n.map(c=>e.createElement("li",{key:c.id,className:"border rounded p-3"},e.createElement("p",{className:"text-sm text-gray-500"},c.name||"Anon"),e.createElement("p",null,c.body)))))}const U=[{key:"davidAllison",name:"David & Allison",clientName:"David and Allison",emails:[]},{key:"sanjay",name:"Sanjay",clientName:"Sanjay",emails:[]},{key:"shelley",name:"Shelley",clientName:"Shelley",emails:[]}];function q(t){if(!t)return null;const a=(t.email||"").toLowerCase(),n=(t.displayName||"").toLowerCase();for(const o of U)for(const m of o.emails)if(a&&m&&a===String(m).toLowerCase())return o.clientName;return n.includes("sanjay")?"Sanjay":n.includes("shelley")?"Shelley":n.includes("david")||n.includes("allison")?"David and Allison":null}const G=()=>{const{user:t}=D(),[a,n]=r.useState([]),[o,m]=r.useState(!1),[y,p]=r.useState(null),[x,c]=r.useState(null),[d]=r.useState(""),[i,E]=r.useState(null),[f,b]=r.useState(null);r.useEffect(()=>{let l=!0;return(async()=>{if(!t){E(null);return}let s=null;try{const u=await L(t.uid);s=(u==null?void 0:u.mealPrepClientName)||null}catch{}if(s||(s=q(t)),s)try{await T(t.uid,{mealPrepClientName:s,email:t.email||null,displayName:t.displayName||null})}catch{}l&&E(s)})(),()=>{l=!1}},[t]),r.useEffect(()=>{let l=!0;return t?((async()=>{try{if(m(!0),p(null),!N||!N.fetch)throw new Error("Content service unavailable");const s=await N.fetch(`*[_type == "mealPrepMenu" && published == true] | order(date desc)[0...50]{
            _id, date, clientName, menu, notes
          }`);l&&n(s||[])}catch(s){l&&p(s.message||String(s))}finally{l&&m(!1)}})(),()=>{l=!1}):(n([]),m(!1),p(null),()=>{l=!1})},[t]);const C=r.useMemo(()=>{const l=i?a.filter(u=>(u.clientName||"").toLowerCase()===i.toLowerCase()):a,s=d.trim().toLowerCase();return s?l.filter(u=>(u.clientName||"").toLowerCase().includes(s)):l},[a,d,i]);return e.createElement(e.Fragment,null,e.createElement(j,null,e.createElement("title",null,"Weekly Meal Prep | Local Effort"),e.createElement("meta",{name:"description",content:"Our Foundation Meal Plan provides 21 nutritious meals per week from local Midwest sources."})),e.createElement("div",{className:"space-y-8"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("h2",{className:"text-4xl md:text-6xl font-bold uppercase"},"Weekly Meal Prep"),e.createElement("div",{className:"flex items-center gap-3"},t?e.createElement(W,{user:t}):w?e.createElement("button",{type:"button",className:"btn btn-primary",onClick:async()=>{try{await S()}catch(l){alert(`Sign-in unavailable: ${(l==null?void 0:l.message)||l}`)}}},"Sign in"):null)),e.createElement("p",{className:"font-mono text-lg max-w-3xl"},"Basic, good nutrition from local Midwest sources. We offer a Foundation Plan and are happy to create custom plans for any diet."),t&&e.createElement("div",{className:"flex gap-2 items-center text-sm text-gray-700"},e.createElement("a",{href:"#menus",className:"underline"},"View current menus"),i?e.createElement("span",null,"for ",e.createElement("strong",null,i)):e.createElement("span",{className:"italic"},"no client assigned yet")),t&&e.createElement("section",{id:"menus",className:"space-y-4"},e.createElement("h3",{className:"text-2xl font-bold"},"Current Menus"),o?e.createElement("p",null,"Loading menus…"):y?e.createElement("div",{className:"text-red-700 bg-red-50 border border-red-200 p-3 rounded"},e.createElement("p",{className:"font-semibold"},y),e.createElement("p",{className:"text-sm mt-1"},"If this persists, ensure Sanity env vars are set on the web app (VITE_APP_SANITY_PROJECT_ID, VITE_APP_SANITY_DATASET) and that the Studio has the new Meal Prep Menu content.")):x?e.createElement("div",null,e.createElement(V,{menu:x,onBack:()=>c(null)}),e.createElement(R,{menuId:x._id,user:t})):e.createElement(I,{menus:C,onSelect:c})),e.createElement(B,{tags:"mealplan",title:"Meal plan photos",perPage:24}),e.createElement("div",{className:"grid md:grid-cols-2 gap-6"},e.createElement("div",{className:"border border-gray-900 rounded-md overflow-hidden"},e.createElement("button",{type:"button",className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100",onClick:()=>b(f==="foundation"?null:"foundation")},e.createElement("span",{className:"text-xl font-bold"},"Foundation Meal Plan"),e.createElement("span",{className:"text-sm text-gray-600"},f==="foundation"?"Hide ▲":"View More ▼")),e.createElement("div",{className:`transition-[max-height,opacity] duration-300 ease-in-out ${f==="foundation"?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden`},e.createElement("div",{className:"p-6"},e.createElement(v,null),e.createElement("p",{className:"font-mono mt-6 max-w-2xl"},"Inspired by the 'Protocol' by Bryan Johnson, this plan provides up to 21 meals/week at ~1800 calories/day.")))),e.createElement("div",{className:"border border-gray-900 rounded-md overflow-hidden"},e.createElement("button",{type:"button",className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100",onClick:()=>b(f==="custom"?null:"custom")},e.createElement("span",{className:"text-xl font-bold"},"Custom Plan"),e.createElement("span",{className:"text-sm text-gray-600"},f==="custom"?"Hide ▲":"View More ▼")),e.createElement("div",{className:`transition-[max-height,opacity] duration-300 ease-in-out ${f==="custom"?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden`},e.createElement("div",{className:"p-6"},e.createElement(v,null),e.createElement("p",{className:"font-mono mt-6 max-w-2xl"},"We tailor plans to your needs (gluten-free, vegetarian, high-protein, etc.). Tell us your goals and preferences and we’ll propose a weekly plan and schedule.")))))))};export{G as MealPrepPage,G as default};
