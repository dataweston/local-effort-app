import{R as e,e as P,h as D,i as T,r as o,k as b,q as F,o as V,l as I,n as L,p as B,t as O,v as j,w as U,c as v,W}from"./index-1W_aNcTa.js";import{E as q}from"./EmblaCarousel-DnUWal-W.js";import{C as G}from"./cloudinaryImage-D8N3jebW.js";import{u as Y}from"./useAuthUser-mdyjgcwM.js";const C=()=>{const t={fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',fontSize:"10px"},a={mixBlendMode:"multiply"},l={fontSize:"10px",fontWeight:"bold",fill:"#000",textAnchor:"middle"},i={...l,fontSize:"8px",fill:"#FFFFFF"};return e.createElement("svg",{viewBox:"0 0 300 200",xmlns:"http://www.w3.org/2000/svg",style:t},e.createElement("circle",{cx:"115",cy:"120",r:"50",fill:"#fde047",style:a}),e.createElement("circle",{cx:"185",cy:"120",r:"50",fill:"#67e8f9",style:a}),e.createElement("circle",{cx:"150",cy:"70",r:"50",fill:"#fca5a5",style:a}),e.createElement("text",{x:"100",y:"130",style:l},"Cost Efficiency"),e.createElement("text",{x:"200",y:"130",style:l},"Local Ingredients"),e.createElement("text",{x:"150",y:"55",style:l},"Perfect Nutrition"),e.createElement("text",{x:"150",y:"105",style:i},"Foundation"),e.createElement("text",{x:"150",y:"115",style:i},"Meal Plan"))};function H({user:t}){return e.createElement("div",{className:"flex items-center gap-3"},P?t?e.createElement(e.Fragment,null,e.createElement("span",{className:"text-sm text-gray-700"},"Hi, ",t.displayName||t.email),e.createElement("button",{onClick:D,className:"px-3 py-2 text-sm rounded border"},"Sign out")):e.createElement("button",{onClick:T,className:"px-3 py-2 text-sm rounded border"},"Sign in"):e.createElement("span",{className:"text-sm text-gray-600"},"Sign-in unavailable"))}function $({menus:t,onSelect:a}){return!t||t.length===0?e.createElement("p",{className:"text-gray-600"},"No menus yet."):e.createElement("ul",{className:"divide-y divide-gray-200 border rounded-md"},t.map(l=>e.createElement("li",{key:l._id,className:"p-4 flex items-center justify-between"},e.createElement("div",null,e.createElement("p",{className:"font-semibold"},l.clientName),e.createElement("p",{className:"text-sm text-gray-500"},"Week of ",l.date)),e.createElement("button",{type:"button",className:"px-3 py-1 rounded bg-gray-900 text-white text-sm",onClick:()=>a&&a(l)},"View"))))}function z({menu:t,onBack:a}){var l;return t?e.createElement("div",{className:"space-y-4"},e.createElement("button",{onClick:a,className:"text-sm text-blue-600"},"← Back"),e.createElement("h4",{className:"text-2xl font-bold"},t.clientName),e.createElement("p",{className:"text-gray-600"},"Week of ",t.date),t.notes&&e.createElement("p",{className:"italic text-gray-700"},t.notes),e.createElement("ul",{className:"list-disc ml-6"},(l=t.menu)==null?void 0:l.map((i,m)=>e.createElement("li",{key:m},i)))):null}function J({menuId:t,user:a}){const[l,i]=o.useState([]),[m,E]=o.useState(""),p=o.useRef(null);o.useEffect(()=>{if(!t||!b)return;const c=F(I(b,"mealprep_comments",t,"comments"),V("createdAt","desc")),u=L(c,d=>{i(d.docs.map(g=>({id:g.id,...g.data()})))});return()=>u()},[t]);const y=async c=>{var d;c.preventDefault();const u=m.trim();u&&b&&(await B(I(b,"mealprep_comments",t,"comments"),{body:u,createdAt:O(),uid:(a==null?void 0:a.uid)||null,name:(a==null?void 0:a.displayName)||"Anonymous"}),E(""),(d=p.current)==null||d.focus())};return e.createElement("div",{className:"mt-8 border-t pt-4"},e.createElement("h5",{className:"font-semibold mb-2"},"Comments"),a?e.createElement("form",{onSubmit:y,className:"flex gap-2 mb-4"},e.createElement("input",{ref:p,value:m,onChange:c=>E(c.target.value),className:"flex-1 border rounded px-3 py-2",placeholder:"Leave a comment"}),e.createElement("button",{className:"px-3 py-2 bg-gray-900 text-white rounded",type:"submit"},"Post")):e.createElement("p",{className:"text-sm text-gray-600"},"Sign in to comment."),e.createElement("ul",{className:"space-y-3"},l.map(c=>e.createElement("li",{key:c.id,className:"border rounded p-3"},e.createElement("p",{className:"text-sm text-gray-500"},c.name||"Anon"),e.createElement("p",null,c.body)))))}const K=[{key:"davidAllison",name:"David & Allison",clientName:"David and Allison",emails:[]},{key:"sanjay",name:"Sanjay",clientName:"Sanjay",emails:[]},{key:"shelley",name:"Shelley",clientName:"Shelley",emails:[]}];function X(t){if(!t)return null;const a=(t.email||"").toLowerCase(),l=(t.displayName||"").toLowerCase();for(const i of K)for(const m of i.emails)if(a&&m&&a===String(m).toLowerCase())return i.clientName;return l.includes("sanjay")?"Sanjay":l.includes("shelley")?"Shelley":l.includes("david")||l.includes("allison")?"David and Allison":null}const Z={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_APP_SANITY_DATASET:"localeffort",VITE_APP_SANITY_PROJECT_ID:"d6l9d0ea",VITE_CLOUDINARY_API_SECRET:"yKO_LHtmCil-5Ta6g-BMAnoEWs8",VITE_CLOUDINARY_CATEGORIZER:"google_tagging",VITE_CLOUDINARY_CLOUD_NAME:"dokyhfvyd",VITE_FIREBASE_API_KEY:"AIzaSyBz4HcPinj3wkeTqVirTVl0bujE0buX6G8",VITE_FIREBASE_APP_ID:"1:641158626848:web:afa272e28d8567c988c645",VITE_FIREBASE_AUTH_DOMAIN:"local-effort.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"641158626848",VITE_FIREBASE_PROJECT_ID:"local-effort",VITE_FIREBASE_STORAGE_BUCKET:"local-effort.appspot.com"},le=()=>{const{user:t}=Y(),[a,l]=o.useState([]),[i,m]=o.useState(!1),[E,p]=o.useState(null),[y,c]=o.useState(null),[u]=o.useState(""),[d,g]=o.useState(null),[f,_]=o.useState(null),[w,k]=o.useState([]);o.useEffect(()=>{let n=!1;return(async()=>{try{const s=await fetch("/api/search-images?query=mealplan&per_page=12");if(!s.ok)throw new Error(`Gallery fetch failed: ${s.status}`);const r=await s.json();if(n)return;const h=(r.images||[]).slice(0,12),S=[];for(let x=0;x<h.length;x+=3){const A=h.slice(x,x+3);S.push({key:A.map(N=>N.public_id).join("|")||`${x}`,node:e.createElement("div",{className:"grid grid-cols-3 gap-3"},A.map((N,R)=>e.createElement(G,{key:N.public_id||R,publicId:N.public_id,alt:N.public_id,className:"w-full aspect-square object-cover rounded transition-transform duration-300 hover:scale-[1.03]",placeholderMode:"none",sizes:"(min-width: 1024px) 33vw, (min-width: 640px) 50vw, 100vw"})))})}k(S)}catch{}})(),()=>{n=!0}},[]),o.useEffect(()=>{let n=!0;return(async()=>{if(!t){g(null);return}let s=null;try{const r=await j(t.uid);s=(r==null?void 0:r.mealPrepClientName)||null}catch{}if(s||(s=X(t)),s)try{await U(t.uid,{mealPrepClientName:s,email:t.email||null,displayName:t.displayName||null})}catch{}n&&g(s)})(),()=>{n=!1}},[t]),o.useEffect(()=>{let n=!0;return t?((async()=>{try{if(m(!0),p(null),!v||!v.fetch)throw new Error("Content service unavailable");const s=await v.fetch(`*[_type == "mealPrepMenu" && published == true] | order(date desc)[0...50]{
            _id, date, clientName, menu, notes
          }`);n&&l(s||[])}catch(s){n&&p(s.message||String(s))}finally{n&&m(!1)}})(),()=>{n=!1}):(l([]),m(!1),p(null),()=>{n=!1})},[t]);const M=o.useMemo(()=>{const n=d?a.filter(r=>(r.clientName||"").toLowerCase()===d.toLowerCase()):a,s=u.trim().toLowerCase();return s?n.filter(r=>(r.clientName||"").toLowerCase().includes(s)):n},[a,u,d]);return e.createElement(e.Fragment,null,e.createElement(W,null,e.createElement("title",null,"Weekly Meal Prep | Local Effort"),e.createElement("meta",{name:"description",content:"Our Foundation Meal Plan provides 21 nutritious meals per week from local Midwest sources."})),e.createElement("div",{className:"space-y-8"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("h2",{className:"text-4xl md:text-6xl font-bold uppercase"},"Weekly Meal Prep"),e.createElement("div",{className:"flex items-center gap-3"},t?e.createElement(H,{user:t}):P?e.createElement("button",{type:"button",className:"btn btn-primary",onClick:async()=>{try{await T()}catch(n){alert(`Sign-in unavailable: ${(n==null?void 0:n.message)||n}`)}}},"Sign in"):null)),e.createElement("p",{className:"font-mono text-lg max-w-3xl"},"Basic, good nutrition from local Midwest sources. We offer a Foundation Plan and are happy to create custom plans for any diet."),t&&e.createElement("div",{className:"flex gap-2 items-center text-sm text-gray-700"},e.createElement("a",{href:"#menus",className:"underline"},"View current menus"),d?e.createElement("span",null,"for ",e.createElement("strong",null,d)):e.createElement("span",{className:"italic"},"no client assigned yet")),t&&e.createElement("section",{id:"menus",className:"space-y-4"},e.createElement("h3",{className:"text-2xl font-bold"},"Current Menus"),i?e.createElement("p",null,"Loading menus…"):E?e.createElement("div",{className:"text-red-700 bg-red-50 border border-red-200 p-3 rounded"},e.createElement("p",{className:"font-semibold"},E),e.createElement("p",{className:"text-sm mt-1"},"If this persists, ensure Sanity env vars are set on the web app (VITE_APP_SANITY_PROJECT_ID, VITE_APP_SANITY_DATASET) and that the Studio has the new Meal Prep Menu content.")):y?e.createElement("div",null,e.createElement(z,{menu:y,onBack:()=>c(null)}),e.createElement(J,{menuId:y._id,user:t})):e.createElement($,{menus:M,onSelect:c})),w.length>0&&e.createElement("div",{className:"min-h-[14rem] md:min-h-[18rem] lg:min-h-[22rem]"},e.createElement(q,{slides:w.map((n,s)=>({key:n.key||s,node:e.createElement("div",{className:"grid grid-cols-3 gap-3"},n.node.props.children.map((r,h)=>e.createElement("div",{key:h,className:"overflow-hidden rounded"},r.props&&r.props.publicId?e.createElement("img",{src:`https://res.cloudinary.com/${Z&&"dokyhfvyd"||""}/image/upload/f_auto,q_auto,w_800/${r.props.publicId}`,alt:r.props.alt||"",className:"w-full aspect-square object-cover"}):r)))})),autoPlayMs:7e3,contain:!1,heightClass:"h-[22vh] md:h-[28vh] lg:h-[34vh]",showThumbs:!1})),e.createElement("div",{className:"grid md:grid-cols-2 gap-6"},e.createElement("div",{className:"border border-gray-900 rounded-md overflow-hidden"},e.createElement("button",{type:"button",className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100",onClick:()=>_(f==="foundation"?null:"foundation")},e.createElement("span",{className:"text-xl font-bold"},"Foundation Meal Plan"),e.createElement("span",{className:"text-sm text-gray-600"},f==="foundation"?"Hide ▲":"View More ▼")),e.createElement("div",{className:`transition-[max-height,opacity] duration-300 ease-in-out ${f==="foundation"?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden`},e.createElement("div",{className:"p-6"},e.createElement(C,null),e.createElement("p",{className:"font-mono mt-6 max-w-2xl"},"Inspired by the 'Protocol' by Bryan Johnson, this plan provides up to 21 meals/week at ~1800 calories/day.")))),e.createElement("div",{className:"border border-gray-900 rounded-md overflow-hidden"},e.createElement("button",{type:"button",className:"w-full flex items-center justify-between px-4 py-3 bg-gray-50 hover:bg-gray-100",onClick:()=>_(f==="custom"?null:"custom")},e.createElement("span",{className:"text-xl font-bold"},"Custom Plan"),e.createElement("span",{className:"text-sm text-gray-600"},f==="custom"?"Hide ▲":"View More ▼")),e.createElement("div",{className:`transition-[max-height,opacity] duration-300 ease-in-out ${f==="custom"?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"} overflow-hidden`},e.createElement("div",{className:"p-6"},e.createElement(C,null),e.createElement("p",{className:"font-mono mt-6 max-w-2xl"},"We tailor plans to your needs (gluten-free, vegetarian, high-protein, etc.). Tell us your goals and preferences and we’ll propose a weekly plan and schedule.")))))))};export{le as MealPrepPage,le as default};
